!function webpackUniversalModuleDefinition(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.recreateTransform=e():t.recreateTransform=e()}(global,(function(){return function(t){var e={};function __webpack_require__(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,__webpack_require__),r.l=!0,r.exports}return __webpack_require__.m=t,__webpack_require__.c=e,__webpack_require__.d=function(t,e,n){__webpack_require__.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},__webpack_require__.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},__webpack_require__.t=function(t,e){if(1&e&&(t=__webpack_require__(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(__webpack_require__.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)__webpack_require__.d(n,r,function(e){return t[e]}.bind(null,r));return n},__webpack_require__.n=function(t){var e=t&&t.__esModule?function getDefault(){return t.default}:function getModuleExports(){return t};return __webpack_require__.d(e,"a",e),e},__webpack_require__.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=3)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),o=n(4),i=n(6);function createTest(t,e){var n=r.Pointer.fromJSON(e).evaluate(t);if(void 0!==n)return{op:"test",path:e,value:n.value}}e.applyPatch=function applyPatch(t,e){return e.map((function(e){return o.apply(t,e)}))},e.createPatch=function createPatch(t,e,n){var o=new r.Pointer;return(n?function wrapVoidableDiff(t){return function wrappedDiff(e,n,r){var o=t(e,n,r);return Array.isArray(o)?o:i.diffAny(e,n,r,wrappedDiff)}}(n):i.diffAny)(t,e,o)},e.createTests=function createTests(t,e){var n=new Array;return e.filter(i.isDestructive).forEach((function(e){var r=createTest(t,e.path);if(r&&n.push(r),"from"in e){var o=createTest(t,e.from);o&&n.push(o)}})),n}},function(t,e,n){"use strict";function unescape(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function escape(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function Pointer(t){void 0===t&&(t=[""]),this.tokens=t}return Pointer.fromJSON=function(t){var e=t.split("/").map(unescape);if(""!==e[0])throw new Error("Invalid JSON Pointer: "+t);return new Pointer(e)},Pointer.prototype.toString=function(){return this.tokens.map(escape).join("/")},Pointer.prototype.evaluate=function(t){for(var e=null,n="",r=t,o=1,i=this.tokens.length;o<i;o++)r=((e=r)||{})[n=this.tokens[o]];return{parent:e,key:n,value:r}},Pointer.prototype.get=function(t){return this.evaluate(t).value},Pointer.prototype.set=function(t,e){for(var n=t,r=1,o=this.tokens.length-1,i=this.tokens[r];r<o;r++)n=(n||{})[i];n&&(n[this.tokens[this.tokens.length-1]]=e)},Pointer.prototype.push=function(t){this.tokens.push(t)},Pointer.prototype.add=function(t){return new Pointer(this.tokens.concat(String(t)))},Pointer}();e.Pointer=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=Object.prototype.hasOwnProperty;function objectType(t){return void 0===t?"undefined":null===t?"null":Array.isArray(t)?"array":typeof t}function compare(t,e){if(t===e)return!0;var n=objectType(t),o=objectType(e);return"array"==n&&"array"==o?function compareArrays(t,e){var n=t.length;if(n!==e.length)return!1;for(var r=0;r<n;r++)if(!compare(t[r],e[r]))return!1;return!0}(t,e):"object"==n&&"object"==o&&function compareObjects(t,e){var n=Object.keys(t),o=Object.keys(e),i=n.length;if(i!==o.length)return!1;for(var s=0;s<i;s++){var a=n[s];if(!r.call(e,a)||!compare(t[a],e[a]))return!1}return!0}(t,e)}e.objectType=objectType,e.compare=compare},function(t,e,n){t.exports=n(7)},function(t,e,n){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function __(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),s=n(5),a=n(2),p=function(t){function MissingError(e){var n=t.call(this,"Value required at path: "+e)||this;return n.path=e,n.name="MissingError",n}return o(MissingError,t),MissingError}(Error);e.MissingError=p;var c=function(t){function TestError(e,n){var r=t.call(this,"Test failed: "+e+" != "+n)||this;return r.actual=e,r.expected=n,r.name="TestError",r.actual=e,r.expected=n,r}return o(TestError,t),TestError}(Error);function _add(t,e,n){if(Array.isArray(t))if("-"==e)t.push(n);else{var r=parseInt(e,10);t.splice(r,0,n)}else t[e]=n}function _remove(t,e){if(Array.isArray(t)){var n=parseInt(e,10);t.splice(n,1)}else delete t[e]}function add(t,e){var n=i.Pointer.fromJSON(e.path).evaluate(t);return void 0===n.parent?new p(e.path):(_add(n.parent,n.key,s.clone(e.value)),null)}function remove(t,e){var n=i.Pointer.fromJSON(e.path).evaluate(t);return void 0===n.value?new p(e.path):(_remove(n.parent,n.key),null)}function replace(t,e){var n=i.Pointer.fromJSON(e.path).evaluate(t);if(null===n.parent)return new p(e.path);if(Array.isArray(n.parent)){if(parseInt(n.key,10)>=n.parent.length)return new p(e.path)}else if(void 0===n.value)return new p(e.path);return n.parent[n.key]=e.value,null}function move(t,e){var n=i.Pointer.fromJSON(e.from).evaluate(t);if(void 0===n.value)return new p(e.from);var r=i.Pointer.fromJSON(e.path).evaluate(t);return void 0===r.parent?new p(e.path):(_remove(n.parent,n.key),_add(r.parent,r.key,n.value),null)}function copy(t,e){var n=i.Pointer.fromJSON(e.from).evaluate(t);if(void 0===n.value)return new p(e.from);var r=i.Pointer.fromJSON(e.path).evaluate(t);return void 0===r.parent?new p(e.path):(_add(r.parent,r.key,s.clone(n.value)),null)}function test(t,e){var n=i.Pointer.fromJSON(e.path).evaluate(t);return a.compare(n.value,e.value)?null:new c(n.value,e.value)}e.TestError=c,e.add=add,e.remove=remove,e.replace=replace,e.move=move,e.copy=copy,e.test=test;var h=function(t){function InvalidOperationError(e){var n=t.call(this,"Invalid operation: "+e.op)||this;return n.operation=e,n.name="InvalidOperationError",n}return o(InvalidOperationError,t),InvalidOperationError}(Error);e.InvalidOperationError=h,e.apply=function apply(t,e){switch(e.op){case"add":return add(t,e);case"remove":return remove(t,e);case"replace":return replace(t,e);case"move":return move(t,e);case"copy":return copy(t,e);case"test":return test(t,e)}return new h(e)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=Object.prototype.hasOwnProperty;e.clone=function clone(t){if(null==t||"object"!=typeof t)return t;if(t.constructor==Array){for(var e=t.length,n=new Array(e),o=0;o<e;o++)n[o]=clone(t[o]);return n}var i={};for(var s in t)r.call(t,s)&&(i[s]=clone(t[s]));return i}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),o=Object.prototype.hasOwnProperty;function subtract(t,e){var n={};for(var r in t)o.call(t,r)&&void 0!==t[r]&&(n[r]=1);for(var i in e)o.call(e,i)&&void 0!==e[i]&&delete n[i];return Object.keys(n)}function intersection(t){for(var e=t.length,n={},r=0;r<e;r++){var i=t[r];for(var s in i)o.call(i,s)&&void 0!==i[s]&&(n[s]=(n[s]||0)+1)}for(var s in n)n[s]<e&&delete n[s];return Object.keys(n)}function appendArrayOperation(t,e){return{operations:t.operations.concat(e),cost:t.cost+1}}function diffArrays(t,e,n,o){void 0===o&&(o=diffAny);var i={"0,0":{operations:[],cost:0}};var s=isNaN(t.length)||t.length<=0?0:t.length,a=isNaN(e.length)||e.length<=0?0:e.length;return function dist(n,o){var s=n+","+o,a=i[s];if(void 0===a){if(n>0&&o>0&&r.compare(t[n-1],e[o-1]))a=dist(n-1,o-1);else{var p=[];if(n>0){var c=dist(n-1,o),h={op:"remove",index:n-1};p.push(appendArrayOperation(c,h))}if(o>0){var f=dist(n,o-1),u={op:"add",index:n-1,value:e[o-1]};p.push(appendArrayOperation(f,u))}if(n>0&&o>0){var l=dist(n-1,o-1),d={op:"replace",index:n-1,original:t[n-1],value:e[o-1]};p.push(appendArrayOperation(l,d))}a=p.sort((function(t,e){return t.cost-e.cost}))[0]}i[s]=a}return a}(s,a).operations.reduce((function(t,e){var r=t[0],i=t[1];if(function isArrayAdd(t){return"add"===t.op}(e)){var a=e.index+1+i,p=a<s+i?String(a):"-",c={op:e.op,path:n.add(p).toString(),value:e.value};return[r.concat(c),i+1]}if(function isArrayRemove(t){return"remove"===t.op}(e)){c={op:e.op,path:n.add(String(e.index+i)).toString()};return[r.concat(c),i-1]}var h=n.add(String(e.index+i)),f=o(e.original,e.value,h);return[r.concat.apply(r,f),i]}),[[],0])[0]}function diffObjects(t,e,n,r){void 0===r&&(r=diffAny);var o=[];return subtract(t,e).forEach((function(t){o.push({op:"remove",path:n.add(t).toString()})})),subtract(e,t).forEach((function(t){o.push({op:"add",path:n.add(t).toString(),value:e[t]})})),intersection([t,e]).forEach((function(i){o.push.apply(o,r(t[i],e[i],n.add(i)))})),o}function diffValues(t,e,n){return r.compare(t,e)?[]:[{op:"replace",path:n.toString(),value:e}]}function diffAny(t,e,n,o){void 0===o&&(o=diffAny);var i=r.objectType(t),s=r.objectType(e);return"array"==i&&"array"==s?diffArrays(t,e,n,o):"object"==i&&"object"==s?diffObjects(t,e,n,o):diffValues(t,e,n)}e.isDestructive=function isDestructive(t){var e=t.op;return"remove"===e||"replace"===e||"copy"===e||"move"===e},e.subtract=subtract,e.intersection=intersection,e.diffArrays=diffArrays,e.diffObjects=diffObjects,e.diffValues=diffValues,e.diffAny=diffAny},function(t,e,n){"use strict";function OrderedMap(t){this.content=t}n.r(e),n.d(e,"recreateTransform",(function(){return recreateTransform})),n.d(e,"RecreateTransform",(function(){return recreateTransform_RecreateTransform})),OrderedMap.prototype={constructor:OrderedMap,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return-1==e?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,o=r.find(t),i=r.content.slice();return-1==o?i.push(n||t,e):(i[o+1]=e,n&&(i[o]=n)),new OrderedMap(i)},remove:function(t){var e=this.find(t);if(-1==e)return this;var n=this.content.slice();return n.splice(e,2),new OrderedMap(n)},addToStart:function(t,e){return new OrderedMap([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new OrderedMap(n)},addBefore:function(t,e,n){var r=this.remove(e),o=r.content.slice(),i=r.find(t);return o.splice(-1==i?o.length:i,0,e,n),new OrderedMap(o)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return(t=OrderedMap.from(t)).size?new OrderedMap(t.content.concat(this.subtract(t).content)):this},append:function(t){return(t=OrderedMap.from(t)).size?new OrderedMap(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=OrderedMap.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},get size(){return this.content.length>>1}},OrderedMap.from=function(t){if(t instanceof OrderedMap)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new OrderedMap(e)};var r=OrderedMap;var o=function Fragment(t,e){if(this.content=t,this.size=e||0,null==e)for(var n=0;n<t.length;n++)this.size+=t[n].nodeSize},i={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};o.prototype.nodesBetween=function nodesBetween(t,e,n,r,o){void 0===r&&(r=0);for(var i=0,s=0;s<e;i++){var a=this.content[i],p=s+a.nodeSize;if(p>t&&!1!==n(a,r+s,o,i)&&a.content.size){var c=s+1;a.nodesBetween(Math.max(0,t-c),Math.min(a.content.size,e-c),n,r+c)}s=p}},o.prototype.descendants=function descendants(t){this.nodesBetween(0,this.size,t)},o.prototype.textBetween=function textBetween(t,e,n,r){var o="",i=!0;return this.nodesBetween(t,e,(function(s,a){s.isText?(o+=s.text.slice(Math.max(t,a)-a,e-a),i=!n):s.isLeaf&&r?(o+=r,i=!n):!i&&s.isBlock&&(o+=n,i=!0)}),0),o},o.prototype.append=function append(t){if(!t.size)return this;if(!this.size)return t;var e=this.lastChild,n=t.firstChild,r=this.content.slice(),i=0;for(e.isText&&e.sameMarkup(n)&&(r[r.length-1]=e.withText(e.text+n.text),i=1);i<t.content.length;i++)r.push(t.content[i]);return new o(r,this.size+t.size)},o.prototype.cut=function cut(t,e){if(null==e&&(e=this.size),0==t&&e==this.size)return this;var n=[],r=0;if(e>t)for(var i=0,s=0;s<e;i++){var a=this.content[i],p=s+a.nodeSize;p>t&&((s<t||p>e)&&(a=a.isText?a.cut(Math.max(0,t-s),Math.min(a.text.length,e-s)):a.cut(Math.max(0,t-s-1),Math.min(a.content.size,e-s-1))),n.push(a),r+=a.nodeSize),s=p}return new o(n,r)},o.prototype.cutByIndex=function cutByIndex(t,e){return t==e?o.empty:0==t&&e==this.content.length?this:new o(this.content.slice(t,e))},o.prototype.replaceChild=function replaceChild(t,e){var n=this.content[t];if(n==e)return this;var r=this.content.slice(),i=this.size+e.nodeSize-n.nodeSize;return r[t]=e,new o(r,i)},o.prototype.addToStart=function addToStart(t){return new o([t].concat(this.content),this.size+t.nodeSize)},o.prototype.addToEnd=function addToEnd(t){return new o(this.content.concat(t),this.size+t.nodeSize)},o.prototype.eq=function eq(t){if(this.content.length!=t.content.length)return!1;for(var e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0},i.firstChild.get=function(){return this.content.length?this.content[0]:null},i.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null},i.childCount.get=function(){return this.content.length},o.prototype.child=function child(t){var e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e},o.prototype.maybeChild=function maybeChild(t){return this.content[t]},o.prototype.forEach=function forEach(t){for(var e=0,n=0;e<this.content.length;e++){var r=this.content[e];t(r,n,e),n+=r.nodeSize}},o.prototype.findDiffStart=function findDiffStart$1(t,e){return void 0===e&&(e=0),function findDiffStart(t,e,n){for(var r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;var o=t.child(r),i=e.child(r);if(o!=i){if(!o.sameMarkup(i))return n;if(o.isText&&o.text!=i.text){for(var s=0;o.text[s]==i.text[s];s++)n++;return n}if(o.content.size||i.content.size){var a=findDiffStart(o.content,i.content,n+1);if(null!=a)return a}n+=o.nodeSize}else n+=o.nodeSize}}(this,t,e)},o.prototype.findDiffEnd=function findDiffEnd$1(t,e,n){return void 0===e&&(e=this.size),void 0===n&&(n=t.size),function findDiffEnd(t,e,n,r){for(var o=t.childCount,i=e.childCount;;){if(0==o||0==i)return o==i?null:{a:n,b:r};var s=t.child(--o),a=e.child(--i),p=s.nodeSize;if(s!=a){if(!s.sameMarkup(a))return{a:n,b:r};if(s.isText&&s.text!=a.text){for(var c=0,h=Math.min(s.text.length,a.text.length);c<h&&s.text[s.text.length-c-1]==a.text[a.text.length-c-1];)c++,n--,r--;return{a:n,b:r}}if(s.content.size||a.content.size){var f=findDiffEnd(s.content,a.content,n-1,r-1);if(f)return f}n-=p,r-=p}else n-=p,r-=p}}(this,t,e,n)},o.prototype.findIndex=function findIndex(t,e){if(void 0===e&&(e=-1),0==t)return retIndex(0,t);if(t==this.size)return retIndex(this.content.length,t);if(t>this.size||t<0)throw new RangeError("Position "+t+" outside of fragment ("+this+")");for(var n=0,r=0;;n++){var o=r+this.child(n).nodeSize;if(o>=t)return o==t||e>0?retIndex(n+1,o):retIndex(n,r);r=o}},o.prototype.toString=function toString(){return"<"+this.toStringInner()+">"},o.prototype.toStringInner=function toStringInner(){return this.content.join(", ")},o.prototype.toJSON=function toJSON(){return this.content.length?this.content.map((function(t){return t.toJSON()})):null},o.fromJSON=function fromJSON(t,e){if(!e)return o.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new o(e.map(t.nodeFromJSON))},o.fromArray=function fromArray(t){if(!t.length)return o.empty;for(var e,n=0,r=0;r<t.length;r++){var i=t[r];n+=i.nodeSize,r&&i.isText&&t[r-1].sameMarkup(i)?(e||(e=t.slice(0,r)),e[e.length-1]=i.withText(e[e.length-1].text+i.text)):e&&e.push(i)}return new o(e||t,n)},o.from=function from(t){if(!t)return o.empty;if(t instanceof o)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new o([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))},Object.defineProperties(o.prototype,i);var s={index:0,offset:0};function retIndex(t,e){return s.index=t,s.offset=e,s}function compareDeep(t,e){if(t===e)return!0;if(!t||"object"!=typeof t||!e||"object"!=typeof e)return!1;var n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(var r=0;r<t.length;r++)if(!compareDeep(t[r],e[r]))return!1}else{for(var o in t)if(!(o in e)||!compareDeep(t[o],e[o]))return!1;for(var i in e)if(!(i in t))return!1}return!0}o.empty=new o([],0);var a=function Mark(t,e){this.type=t,this.attrs=e};function ReplaceError(t){var e=Error.call(this,t);return e.__proto__=ReplaceError.prototype,e}a.prototype.addToSet=function addToSet(t){for(var e,n=!1,r=0;r<t.length;r++){var o=t[r];if(this.eq(o))return t;if(this.type.excludes(o.type))e||(e=t.slice(0,r));else{if(o.type.excludes(this.type))return t;!n&&o.type.rank>this.type.rank&&(e||(e=t.slice(0,r)),e.push(this),n=!0),e&&e.push(o)}}return e||(e=t.slice()),n||e.push(this),e},a.prototype.removeFromSet=function removeFromSet(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t},a.prototype.isInSet=function isInSet(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1},a.prototype.eq=function eq(t){return this==t||this.type==t.type&&compareDeep(this.attrs,t.attrs)},a.prototype.toJSON=function toJSON(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return t},a.fromJSON=function fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");var n=t.marks[e.type];if(!n)throw new RangeError("There is no mark type "+e.type+" in this schema");return n.create(e.attrs)},a.sameSet=function sameSet(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0},a.setFrom=function setFrom(t){if(!t||0==t.length)return a.none;if(t instanceof a)return[t];var e=t.slice();return e.sort((function(t,e){return t.type.rank-e.type.rank})),e},a.none=[],ReplaceError.prototype=Object.create(Error.prototype),ReplaceError.prototype.constructor=ReplaceError,ReplaceError.prototype.name="ReplaceError";var p=function Slice(t,e,n){this.content=t,this.openStart=e,this.openEnd=n},c={size:{configurable:!0}};function replace(t,e,n){if(n.openStart>t.depth)throw new ReplaceError("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new ReplaceError("Inconsistent open depths");return function replaceOuter(t,e,n,r){var i=t.index(r),s=t.node(r);if(i==e.index(r)&&r<t.depth-n.openStart){var a=replaceOuter(t,e,n,r+1);return s.copy(s.content.replaceChild(i,a))}if(n.content.size){if(n.openStart||n.openEnd||t.depth!=r||e.depth!=r){var p=function prepareSliceForReplace(t,e){for(var n=e.depth-t.openStart,r=e.node(n).copy(t.content),i=n-1;i>=0;i--)r=e.node(i).copy(o.from(r));return{start:r.resolveNoCache(t.openStart+n),end:r.resolveNoCache(r.content.size-t.openEnd-n)}}(n,t),c=p.start,h=p.end;return index_es_close(s,function replaceThreeWay(t,e,n,r,i){var s=t.depth>i&&joinable(t,e,i+1),a=r.depth>i&&joinable(n,r,i+1),p=[];addRange(null,t,i,p),s&&a&&e.index(i)==n.index(i)?(checkJoin(s,a),addNode(index_es_close(s,replaceThreeWay(t,e,n,r,i+1)),p)):(s&&addNode(index_es_close(s,replaceTwoWay(t,e,i+1)),p),addRange(e,n,i,p),a&&addNode(index_es_close(a,replaceTwoWay(n,r,i+1)),p));return addRange(r,null,i,p),new o(p)}(t,c,h,e,r))}var f=t.parent,u=f.content;return index_es_close(f,u.cut(0,t.parentOffset).append(n.content).append(u.cut(e.parentOffset)))}return index_es_close(s,replaceTwoWay(t,e,r))}(t,e,n,0)}function checkJoin(t,e){if(!e.type.compatibleContent(t.type))throw new ReplaceError("Cannot join "+e.type.name+" onto "+t.type.name)}function joinable(t,e,n){var r=t.node(n);return checkJoin(r,e.node(n)),r}function addNode(t,e){var n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function addRange(t,e,n,r){var o=(e||t).node(n),i=0,s=e?e.index(n):o.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&(addNode(t.nodeAfter,r),i++));for(var a=i;a<s;a++)addNode(o.child(a),r);e&&e.depth==n&&e.textOffset&&addNode(e.nodeBefore,r)}function index_es_close(t,e){if(!t.type.validContent(e))throw new ReplaceError("Invalid content for node "+t.type.name);return t.copy(e)}function replaceTwoWay(t,e,n){var r=[];(addRange(null,t,n,r),t.depth>n)&&addNode(index_es_close(joinable(t,e,n+1),replaceTwoWay(t,e,n+1)),r);return addRange(e,null,n,r),new o(r)}c.size.get=function(){return this.content.size-this.openStart-this.openEnd},p.prototype.insertAt=function insertAt(t,e){var n=function insertInto(t,e,n,r){var o=t.findIndex(e),i=o.index,s=o.offset,a=t.maybeChild(i);if(s==e||a.isText)return r&&!r.canReplace(i,i,n)?null:t.cut(0,e).append(n).append(t.cut(e));var p=insertInto(a.content,e-s-1,n);return p&&t.replaceChild(i,a.copy(p))}(this.content,t+this.openStart,e,null);return n&&new p(n,this.openStart,this.openEnd)},p.prototype.removeBetween=function removeBetween(t,e){return new p(function removeRange(t,e,n){var r=t.findIndex(e),o=r.index,i=r.offset,s=t.maybeChild(o),a=t.findIndex(n),p=a.index,c=a.offset;if(i==e||s.isText){if(c!=n&&!t.child(p).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(o!=p)throw new RangeError("Removing non-flat range");return t.replaceChild(o,s.copy(removeRange(s.content,e-i-1,n-i-1)))}(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)},p.prototype.eq=function eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd},p.prototype.toString=function toString(){return this.content+"("+this.openStart+","+this.openEnd+")"},p.prototype.toJSON=function toJSON(){if(!this.content.size)return null;var t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t},p.fromJSON=function fromJSON(t,e){if(!e)return p.empty;var n=e.openStart||0,r=e.openEnd||0;if("number"!=typeof n||"number"!=typeof r)throw new RangeError("Invalid input for Slice.fromJSON");return new p(o.fromJSON(t,e.content),e.openStart||0,e.openEnd||0)},p.maxOpen=function maxOpen(t,e){void 0===e&&(e=!0);for(var n=0,r=0,o=t.firstChild;o&&!o.isLeaf&&(e||!o.type.spec.isolating);o=o.firstChild)n++;for(var i=t.lastChild;i&&!i.isLeaf&&(e||!i.type.spec.isolating);i=i.lastChild)r++;return new p(t,n,r)},Object.defineProperties(p.prototype,c),p.empty=new p(o.empty,0,0);var h=function ResolvedPos(t,e,n){this.pos=t,this.path=e,this.depth=e.length/3-1,this.parentOffset=n},f={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};h.prototype.resolveDepth=function resolveDepth(t){return null==t?this.depth:t<0?this.depth+t:t},f.parent.get=function(){return this.node(this.depth)},f.doc.get=function(){return this.node(0)},h.prototype.node=function node(t){return this.path[3*this.resolveDepth(t)]},h.prototype.index=function index(t){return this.path[3*this.resolveDepth(t)+1]},h.prototype.indexAfter=function indexAfter(t){return t=this.resolveDepth(t),this.index(t)+(t!=this.depth||this.textOffset?1:0)},h.prototype.start=function start(t){return 0==(t=this.resolveDepth(t))?0:this.path[3*t-1]+1},h.prototype.end=function end(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size},h.prototype.before=function before(t){if(!(t=this.resolveDepth(t)))throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]},h.prototype.after=function after(t){if(!(t=this.resolveDepth(t)))throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]+this.path[3*t].nodeSize},f.textOffset.get=function(){return this.pos-this.path[this.path.length-1]},f.nodeAfter.get=function(){var t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;var n=this.pos-this.path[this.path.length-1],r=t.child(e);return n?t.child(e).cut(n):r},f.nodeBefore.get=function(){var t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):0==t?null:this.parent.child(t-1)},h.prototype.marks=function marks(){var t=this.parent,e=this.index();if(0==t.content.size)return a.none;if(this.textOffset)return t.child(e).marks;var n=t.maybeChild(e-1),r=t.maybeChild(e);if(!n){var o=n;n=r,r=o}for(var marks=n.marks,i=0;i<marks.length;i++)!1!==marks[i].type.spec.inclusive||r&&marks[i].isInSet(r.marks)||(marks=marks[i--].removeFromSet(marks));return marks},h.prototype.marksAcross=function marksAcross(t){var e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;for(var n=e.marks,r=t.parent.maybeChild(t.index()),o=0;o<n.length;o++)!1!==n[o].type.spec.inclusive||r&&n[o].isInSet(r.marks)||(n=n[o--].removeFromSet(n));return n},h.prototype.sharedDepth=function sharedDepth(t){for(var e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0},h.prototype.blockRange=function blockRange(t,e){if(void 0===t&&(t=this),t.pos<this.pos)return t.blockRange(this);for(var n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--)if(t.pos<=this.end(n)&&(!e||e(this.node(n))))return new m(this,t,n)},h.prototype.sameParent=function sameParent(t){return this.pos-this.parentOffset==t.pos-t.parentOffset},h.prototype.max=function max(t){return t.pos>this.pos?t:this},h.prototype.min=function min(t){return t.pos<this.pos?t:this},h.prototype.toString=function toString(){for(var t="",e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset},h.resolve=function resolve(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");for(var n=[],r=0,o=e,i=t;;){var s=i.content.findIndex(o),a=s.index,p=s.offset,c=o-p;if(n.push(i,a,r+p),!c)break;if((i=i.child(a)).isText)break;o=c-1,r+=p+1}return new h(e,n,o)},h.resolveCached=function resolveCached(t,e){for(var n=0;n<u.length;n++){var r=u[n];if(r.pos==e&&r.doc==t)return r}var o=u[l]=h.resolve(t,e);return l=(l+1)%d,o},Object.defineProperties(h.prototype,f);var u=[],l=0,d=12,m=function NodeRange(t,e,n){this.$from=t,this.$to=e,this.depth=n},v={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};v.start.get=function(){return this.$from.before(this.depth+1)},v.end.get=function(){return this.$to.after(this.depth+1)},v.parent.get=function(){return this.$from.node(this.depth)},v.startIndex.get=function(){return this.$from.index(this.depth)},v.endIndex.get=function(){return this.$to.indexAfter(this.depth)},Object.defineProperties(m.prototype,v);var y=Object.create(null),g=function Node(t,e,n,r){this.type=t,this.attrs=e,this.content=n||o.empty,this.marks=r||a.none},S={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};S.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size},S.childCount.get=function(){return this.content.childCount},g.prototype.child=function child(t){return this.content.child(t)},g.prototype.maybeChild=function maybeChild(t){return this.content.maybeChild(t)},g.prototype.forEach=function forEach(t){this.content.forEach(t)},g.prototype.nodesBetween=function nodesBetween(t,e,n,r){void 0===r&&(r=0),this.content.nodesBetween(t,e,n,r,this)},g.prototype.descendants=function descendants(t){this.nodesBetween(0,this.content.size,t)},S.textContent.get=function(){return this.textBetween(0,this.content.size,"")},g.prototype.textBetween=function textBetween(t,e,n,r){return this.content.textBetween(t,e,n,r)},S.firstChild.get=function(){return this.content.firstChild},S.lastChild.get=function(){return this.content.lastChild},g.prototype.eq=function eq(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)},g.prototype.sameMarkup=function sameMarkup(t){return this.hasMarkup(t.type,t.attrs,t.marks)},g.prototype.hasMarkup=function hasMarkup(t,e,n){return this.type==t&&compareDeep(this.attrs,e||t.defaultAttrs||y)&&a.sameSet(this.marks,n||a.none)},g.prototype.copy=function copy(t){return void 0===t&&(t=null),t==this.content?this:new this.constructor(this.type,this.attrs,t,this.marks)},g.prototype.mark=function mark(t){return t==this.marks?this:new this.constructor(this.type,this.attrs,this.content,t)},g.prototype.cut=function cut(t,e){return 0==t&&e==this.content.size?this:this.copy(this.content.cut(t,e))},g.prototype.slice=function slice(t,e,n){if(void 0===e&&(e=this.content.size),void 0===n&&(n=!1),t==e)return p.empty;var r=this.resolve(t),o=this.resolve(e),i=n?0:r.sharedDepth(e),s=r.start(i),a=r.node(i).content.cut(r.pos-s,o.pos-s);return new p(a,r.depth-i,o.depth-i)},g.prototype.replace=function replace$1(t,e,n){return replace(this.resolve(t),this.resolve(e),n)},g.prototype.nodeAt=function nodeAt(t){for(var e=this;;){var n=e.content.findIndex(t),r=n.index,o=n.offset;if(!(e=e.maybeChild(r)))return null;if(o==t||e.isText)return e;t-=o+1}},g.prototype.childAfter=function childAfter(t){var e=this.content.findIndex(t),n=e.index,r=e.offset;return{node:this.content.maybeChild(n),index:n,offset:r}},g.prototype.childBefore=function childBefore(t){if(0==t)return{node:null,index:0,offset:0};var e=this.content.findIndex(t),n=e.index,r=e.offset;if(r<t)return{node:this.content.child(n),index:n,offset:r};var o=this.content.child(n-1);return{node:o,index:n-1,offset:r-o.nodeSize}},g.prototype.resolve=function resolve(t){return h.resolveCached(this,t)},g.prototype.resolveNoCache=function resolveNoCache(t){return h.resolve(this,t)},g.prototype.rangeHasMark=function rangeHasMark(t,e,n){var r=!1;return e>t&&this.nodesBetween(t,e,(function(t){return n.isInSet(t.marks)&&(r=!0),!r})),r},S.isBlock.get=function(){return this.type.isBlock},S.isTextblock.get=function(){return this.type.isTextblock},S.inlineContent.get=function(){return this.type.inlineContent},S.isInline.get=function(){return this.type.isInline},S.isText.get=function(){return this.type.isText},S.isLeaf.get=function(){return this.type.isLeaf},S.isAtom.get=function(){return this.type.isAtom},g.prototype.toString=function toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),wrapMarks(this.marks,t)},g.prototype.contentMatchAt=function contentMatchAt(t){var e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e},g.prototype.canReplace=function canReplace(t,e,n,r,i){void 0===n&&(n=o.empty),void 0===r&&(r=0),void 0===i&&(i=n.childCount);var s=this.contentMatchAt(t).matchFragment(n,r,i),a=s&&s.matchFragment(this.content,e);if(!a||!a.validEnd)return!1;for(var p=r;p<i;p++)if(!this.type.allowsMarks(n.child(p).marks))return!1;return!0},g.prototype.canReplaceWith=function canReplaceWith(t,e,n,r){if(r&&!this.type.allowsMarks(r))return!1;var o=this.contentMatchAt(t).matchType(n),i=o&&o.matchFragment(this.content,e);return!!i&&i.validEnd},g.prototype.canAppend=function canAppend(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)},g.prototype.check=function check(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));this.content.forEach((function(t){return t.check()}))},g.prototype.toJSON=function toJSON(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map((function(t){return t.toJSON()}))),t},g.fromJSON=function fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");var n=null;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=e.marks.map(t.markFromJSON)}if("text"==e.type){if("string"!=typeof e.text)throw new RangeError("Invalid text node in JSON");return t.text(e.text,n)}var r=o.fromJSON(t,e.content);return t.nodeType(e.type).create(e.attrs,r,n)},Object.defineProperties(g.prototype,S);var x=function(t){function TextNode(e,n,r,o){if(t.call(this,e,n,null,o),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}t&&(TextNode.__proto__=t),TextNode.prototype=Object.create(t&&t.prototype),TextNode.prototype.constructor=TextNode;var e={textContent:{configurable:!0},nodeSize:{configurable:!0}};return TextNode.prototype.toString=function toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):wrapMarks(this.marks,JSON.stringify(this.text))},e.textContent.get=function(){return this.text},TextNode.prototype.textBetween=function textBetween(t,e){return this.text.slice(t,e)},e.nodeSize.get=function(){return this.text.length},TextNode.prototype.mark=function mark(t){return t==this.marks?this:new TextNode(this.type,this.attrs,this.text,t)},TextNode.prototype.withText=function withText(t){return t==this.text?this:new TextNode(this.type,this.attrs,t,this.marks)},TextNode.prototype.cut=function cut(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.text.length),0==t&&e==this.text.length?this:this.withText(this.text.slice(t,e))},TextNode.prototype.eq=function eq(t){return this.sameMarkup(t)&&this.text==t.text},TextNode.prototype.toJSON=function toJSON(){var e=t.prototype.toJSON.call(this);return e.text=this.text,e},Object.defineProperties(TextNode.prototype,e),TextNode}(g);function wrapMarks(t,e){for(var n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}var k=function ContentMatch(t){this.validEnd=t,this.next=[],this.wrapCache=[]},w={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};k.parse=function parse(t,e){var n=new b(t,e);if(null==n.next)return k.empty;var r=parseExpr(n);n.next&&n.err("Unexpected trailing text");var o=function dfa(t){var e=Object.create(null);return function explore(n){var r=[];n.forEach((function(e){t[e].forEach((function(e){var n=e.term,o=e.to;if(n){var i=r.indexOf(n),s=i>-1&&r[i+1];nullFrom(t,o).forEach((function(t){s||r.push(n,s=[]),-1==s.indexOf(t)&&s.push(t)}))}}))}));for(var o=e[n.join(",")]=new k(n.indexOf(t.length-1)>-1),i=0;i<r.length;i+=2){var s=r[i+1].sort(cmp);o.next.push(r[i],e[s.join(",")]||explore(s))}return o}(nullFrom(t,0))}(function nfa(t){var e=[[]];return connect(function compile(t,e){if("choice"==t.type)return t.exprs.reduce((function(t,n){return t.concat(compile(n,e))}),[]);if("seq"==t.type)for(var n=0;;n++){var r=compile(t.exprs[n],e);if(n==t.exprs.length-1)return r;connect(r,e=node())}else{if("star"==t.type){var o=node();return edge(e,o),connect(compile(t.expr,o),o),[edge(o)]}if("plus"==t.type){var i=node();return connect(compile(t.expr,e),i),connect(compile(t.expr,i),i),[edge(i)]}if("opt"==t.type)return[edge(e)].concat(compile(t.expr,e));if("range"==t.type){for(var s=e,a=0;a<t.min;a++){var p=node();connect(compile(t.expr,s),p),s=p}if(-1==t.max)connect(compile(t.expr,s),s);else for(var c=t.min;c<t.max;c++){var h=node();edge(s,h),connect(compile(t.expr,s),h),s=h}return[edge(s)]}if("name"==t.type)return[edge(e,null,t.value)]}}(t,0),node()),e;function node(){return e.push([])-1}function edge(t,n,r){var o={term:r,to:n};return e[t].push(o),o}function connect(t,e){t.forEach((function(t){return t.to=e}))}}(r));return function checkForDeadEnds(t,e){for(var n=0,r=[t];n<r.length;n++){for(var o=r[n],i=!o.validEnd,s=[],a=0;a<o.next.length;a+=2){var p=o.next[a],c=o.next[a+1];s.push(p.name),!i||p.isText||p.hasRequiredAttrs()||(i=!1),-1==r.indexOf(c)&&r.push(c)}i&&e.err("Only non-generatable nodes ("+s.join(", ")+") in a required position")}}(o,n),o},k.prototype.matchType=function matchType(t){for(var e=0;e<this.next.length;e+=2)if(this.next[e]==t)return this.next[e+1];return null},k.prototype.matchFragment=function matchFragment(t,e,n){void 0===e&&(e=0),void 0===n&&(n=t.childCount);for(var r=this,o=e;r&&o<n;o++)r=r.matchType(t.child(o).type);return r},w.inlineContent.get=function(){var t=this.next[0];return!!t&&t.isInline},w.defaultType.get=function(){for(var t=0;t<this.next.length;t+=2){var e=this.next[t];if(!e.isText&&!e.hasRequiredAttrs())return e}},k.prototype.compatible=function compatible(t){for(var e=0;e<this.next.length;e+=2)for(var n=0;n<t.next.length;n+=2)if(this.next[e]==t.next[n])return!0;return!1},k.prototype.fillBefore=function fillBefore(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=0);var r=[this];return function search(i,s){var a=i.matchFragment(t,n);if(a&&(!e||a.validEnd))return o.from(s.map((function(t){return t.createAndFill()})));for(var p=0;p<i.next.length;p+=2){var c=i.next[p],h=i.next[p+1];if(!c.isText&&!c.hasRequiredAttrs()&&-1==r.indexOf(h)){r.push(h);var f=search(h,s.concat(c));if(f)return f}}}(this,[])},k.prototype.findWrapping=function findWrapping(t){for(var e=0;e<this.wrapCache.length;e+=2)if(this.wrapCache[e]==t)return this.wrapCache[e+1];var n=this.computeWrapping(t);return this.wrapCache.push(t,n),n},k.prototype.computeWrapping=function computeWrapping(t){for(var e=Object.create(null),n=[{match:this,type:null,via:null}];n.length;){var r=n.shift(),o=r.match;if(o.matchType(t)){for(var i=[],s=r;s.type;s=s.via)i.push(s.type);return i.reverse()}for(var a=0;a<o.next.length;a+=2){var p=o.next[a];p.isLeaf||p.hasRequiredAttrs()||p.name in e||r.type&&!o.next[a+1].validEnd||(n.push({match:p.contentMatch,type:p,via:r}),e[p.name]=!0)}}},w.edgeCount.get=function(){return this.next.length>>1},k.prototype.edge=function edge(t){var e=t<<1;if(e>=this.next.length)throw new RangeError("There's no "+t+"th edge in this content match");return{type:this.next[e],next:this.next[e+1]}},k.prototype.toString=function toString(){var t=[];return function scan(e){t.push(e);for(var n=1;n<e.next.length;n+=2)-1==t.indexOf(e.next[n])&&scan(e.next[n])}(this),t.map((function(e,n){for(var r=n+(e.validEnd?"*":" ")+" ",o=0;o<e.next.length;o+=2)r+=(o?", ":"")+e.next[o].name+"->"+t.indexOf(e.next[o+1]);return r})).join("\n")},Object.defineProperties(k.prototype,w),k.empty=new k(!0);var b=function TokenStream(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.unshift()},O={next:{configurable:!0}};function parseExpr(t){var e=[];do{e.push(parseExprSeq(t))}while(t.eat("|"));return 1==e.length?e[0]:{type:"choice",exprs:e}}function parseExprSeq(t){var e=[];do{e.push(parseExprSubscript(t))}while(t.next&&")"!=t.next&&"|"!=t.next);return 1==e.length?e[0]:{type:"seq",exprs:e}}function parseExprSubscript(t){for(var e=function parseExprAtom(t){if(t.eat("(")){var e=parseExpr(t);return t.eat(")")||t.err("Missing closing paren"),e}if(!/\W/.test(t.next)){var n=function resolveName(t,e){var n=t.nodeTypes,r=n[e];if(r)return[r];var o=[];for(var i in n){var s=n[i];s.groups.indexOf(e)>-1&&o.push(s)}0==o.length&&t.err("No node type or group '"+e+"' found");return o}(t,t.next).map((function(e){return null==t.inline?t.inline=e.isInline:t.inline!=e.isInline&&t.err("Mixing inline and block content"),{type:"name",value:e}}));return t.pos++,1==n.length?n[0]:{type:"choice",exprs:n}}t.err("Unexpected token '"+t.next+"'")}(t);;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else{if(!t.eat("{"))break;e=parseExprRange(t,e)}return e}function parseNum(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");var e=Number(t.next);return t.pos++,e}function parseExprRange(t,e){var n=parseNum(t),r=n;return t.eat(",")&&(r="}"!=t.next?parseNum(t):-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function cmp(t,e){return e-t}function nullFrom(t,e){var n=[];return function scan(e){var r=t[e];if(1==r.length&&!r[0].term)return scan(r[0].to);n.push(e);for(var o=0;o<r.length;o++){var i=r[o],s=i.term,a=i.to;s||-1!=n.indexOf(a)||scan(a)}}(e),n.sort(cmp)}function defaultAttrs(t){var e=Object.create(null);for(var n in t){var r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function computeAttrs(t,e){var n=Object.create(null);for(var r in t){var o=e&&e[r];if(void 0===o){var i=t[r];if(!i.hasDefault)throw new RangeError("No value supplied for attribute "+r);o=i.default}n[r]=o}return n}function initAttrs(t){var e=Object.create(null);if(t)for(var n in t)e[n]=new E(t[n]);return e}O.next.get=function(){return this.tokens[this.pos]},b.prototype.eat=function eat(t){return this.next==t&&(this.pos++||!0)},b.prototype.err=function err(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")},Object.defineProperties(b.prototype,O);var M=function NodeType(t,e,n){this.name=t,this.schema=e,this.spec=n,this.groups=n.group?n.group.split(" "):[],this.attrs=initAttrs(n.attrs),this.defaultAttrs=defaultAttrs(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(n.inline||"text"==t),this.isText="text"==t},N={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};N.isInline.get=function(){return!this.isBlock},N.isTextblock.get=function(){return this.isBlock&&this.inlineContent},N.isLeaf.get=function(){return this.contentMatch==k.empty},N.isAtom.get=function(){return this.isLeaf||this.spec.atom},M.prototype.hasRequiredAttrs=function hasRequiredAttrs(){for(var t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1},M.prototype.compatibleContent=function compatibleContent(t){return this==t||this.contentMatch.compatible(t.contentMatch)},M.prototype.computeAttrs=function computeAttrs$1(t){return!t&&this.defaultAttrs?this.defaultAttrs:computeAttrs(this.attrs,t)},M.prototype.create=function create(t,e,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new g(this,this.computeAttrs(t),o.from(e),a.setFrom(n))},M.prototype.createChecked=function createChecked(t,e,n){if(e=o.from(e),!this.validContent(e))throw new RangeError("Invalid content for node "+this.name);return new g(this,this.computeAttrs(t),e,a.setFrom(n))},M.prototype.createAndFill=function createAndFill(t,e,n){if(t=this.computeAttrs(t),(e=o.from(e)).size){var r=this.contentMatch.fillBefore(e);if(!r)return null;e=r.append(e)}var i=this.contentMatch.matchFragment(e).fillBefore(o.empty,!0);return i?new g(this,t,e.append(i),a.setFrom(n)):null},M.prototype.validContent=function validContent(t){var e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(var n=0;n<t.childCount;n++)if(!this.allowsMarks(t.child(n).marks))return!1;return!0},M.prototype.allowsMarkType=function allowsMarkType(t){return null==this.markSet||this.markSet.indexOf(t)>-1},M.prototype.allowsMarks=function allowsMarks(t){if(null==this.markSet)return!0;for(var e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0},M.prototype.allowedMarks=function allowedMarks(t){if(null==this.markSet)return t;for(var e,n=0;n<t.length;n++)this.allowsMarkType(t[n].type)?e&&e.push(t[n]):e||(e=t.slice(0,n));return e?e.length?e:a.empty:t},M.compile=function compile(t,e){var n=Object.create(null);t.forEach((function(t,r){return n[t]=new M(t,e,r)}));var r=e.spec.topNode||"doc";if(!n[r])throw new RangeError("Schema is missing its top node type ('"+r+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(var o in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n},Object.defineProperties(M.prototype,N);var E=function Attribute(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default"),this.default=t.default},T={isRequired:{configurable:!0}};T.isRequired.get=function(){return!this.hasDefault},Object.defineProperties(E.prototype,T);var C=function MarkType(t,e,n,r){this.name=t,this.schema=n,this.spec=r,this.attrs=initAttrs(r.attrs),this.rank=e,this.excluded=null;var o=defaultAttrs(this.attrs);this.instance=o&&new a(this,o)};C.prototype.create=function create(t){return!t&&this.instance?this.instance:new a(this,computeAttrs(this.attrs,t))},C.compile=function compile(t,e){var n=Object.create(null),r=0;return t.forEach((function(t,o){return n[t]=new C(t,r++,e,o)})),n},C.prototype.removeFromSet=function removeFromSet(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t.slice(0,e).concat(t.slice(e+1));return t},C.prototype.isInSet=function isInSet(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t[e]},C.prototype.excludes=function excludes(t){return this.excluded.indexOf(t)>-1};var R=function Schema(t){for(var e in this.spec={},t)this.spec[e]=t[e];this.spec.nodes=r.from(t.nodes),this.spec.marks=r.from(t.marks),this.nodes=M.compile(this.spec.nodes,this),this.marks=C.compile(this.spec.marks,this);var n=Object.create(null);for(var o in this.nodes){if(o in this.marks)throw new RangeError(o+" can not be both a node and a mark");var i=this.nodes[o],s=i.spec.content||"",a=i.spec.marks;i.contentMatch=n[s]||(n[s]=k.parse(s,this.nodes)),i.inlineContent=i.contentMatch.inlineContent,i.markSet="_"==a?null:a?gatherMarks(this,a.split(" ")):""!=a&&i.inlineContent?null:[]}for(var p in this.marks){var c=this.marks[p],h=c.spec.excludes;c.excluded=null==h?[c]:""==h?[]:gatherMarks(this,h.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached=Object.create(null),this.cached.wrappings=Object.create(null)};function gatherMarks(t,e){for(var n=[],r=0;r<e.length;r++){var o=e[r],i=t.marks[o],s=i;if(i)n.push(i);else for(var a in t.marks){var p=t.marks[a];("_"==o||p.spec.group&&p.spec.group.split(" ").indexOf(o)>-1)&&n.push(s=p)}if(!s)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}R.prototype.node=function node(t,e,n,r){if("string"==typeof t)t=this.nodeType(t);else{if(!(t instanceof M))throw new RangeError("Invalid node type: "+t);if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}return t.createChecked(e,n,r)},R.prototype.text=function text(t,e){var n=this.nodes.text;return new x(n,n.defaultAttrs,t,a.setFrom(e))},R.prototype.mark=function mark(t,e){return"string"==typeof t&&(t=this.marks[t]),t.create(e)},R.prototype.nodeFromJSON=function nodeFromJSON(t){return g.fromJSON(this,t)},R.prototype.markFromJSON=function markFromJSON(t){return a.fromJSON(this,t)},R.prototype.nodeType=function nodeType(t){var e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e};var _=function DOMParser(t,e){var n=this;this.schema=t,this.rules=e,this.tags=[],this.styles=[],e.forEach((function(t){t.tag?n.tags.push(t):t.style&&n.styles.push(t)}))};_.prototype.parse=function parse(t,e){void 0===e&&(e={});var n=new P(this,e,!1);return n.addAll(t,null,e.from,e.to),n.finish()},_.prototype.parseSlice=function parseSlice(t,e){void 0===e&&(e={});var n=new P(this,e,!0);return n.addAll(t,null,e.from,e.to),p.maxOpen(n.finish())},_.prototype.matchTag=function matchTag(t,e){for(var n=0;n<this.tags.length;n++){var r=this.tags[n];if(matches(t,r.tag)&&(void 0===r.namespace||t.namespaceURI==r.namespace)&&(!r.context||e.matchesContext(r.context))){if(r.getAttrs){var o=r.getAttrs(t);if(!1===o)continue;r.attrs=o}return r}}},_.prototype.matchStyle=function matchStyle(t,e,n){for(var r=0;r<this.styles.length;r++){var o=this.styles[r];if(!(0!=o.style.indexOf(t)||o.context&&!n.matchesContext(o.context)||o.style.length>t.length&&(61!=o.style.charCodeAt(t.length)||o.style.slice(t.length+1)!=e))){if(o.getAttrs){var i=o.getAttrs(e);if(!1===i)continue;o.attrs=i}return o}}},_.schemaRules=function schemaRules(t){var e=[];function insert(t){for(var n=null==t.priority?50:t.priority,r=0;r<e.length;r++){var o=e[r];if((null==o.priority?50:o.priority)<n)break}e.splice(r,0,t)}var loop=function(e){var n=t.marks[e].spec.parseDOM;n&&n.forEach((function(t){insert(t=copy(t)),t.mark=e}))};for(var n in t.marks)loop(n);var r;for(var o in t.nodes)r=void 0,(r=t.nodes[o].spec.parseDOM)&&r.forEach((function(t){insert(t=copy(t)),t.node=o}));return e},_.fromSchema=function fromSchema(t){return t.cached.domParser||(t.cached.domParser=new _(t,_.schemaRules(t)))};var A={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},z={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},J={ol:!0,ul:!0};function wsOptionsFor(t){return(t?1:0)|("full"===t?2:0)}var I=function NodeContext(t,e,n,r,o,i,s){this.type=t,this.attrs=e,this.solid=o,this.match=i||(4&s?null:t.contentMatch),this.options=s,this.content=[],this.marks=n,this.activeMarks=a.none,this.pendingMarks=r};I.prototype.findWrapping=function findWrapping(t){if(!this.match){if(!this.type)return[];var e=this.type.contentMatch.fillBefore(o.from(t));if(!e){var n,r=this.type.contentMatch;return(n=r.findWrapping(t.type))?(this.match=r,n):null}this.match=this.type.contentMatch.matchFragment(e)}return this.match.findWrapping(t.type)},I.prototype.finish=function finish(t){if(!(1&this.options)){var e,n=this.content[this.content.length-1];n&&n.isText&&(e=/[ \t\r\n\u000c]+$/.exec(n.text))&&(n.text.length==e[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-e[0].length)))}var r=o.from(this.content);return!t&&this.match&&(r=r.append(this.match.fillBefore(o.empty,!0))),this.type?this.type.create(this.attrs,r,this.marks):r},I.prototype.applyPending=function applyPending(t){for(var e=0,n=this.pendingMarks;e<n.length;e++){var r=n[e];(this.type?this.type.allowsMarkType(r.type):markMayApply(r.type,t))&&!r.isInSet(this.activeMarks)&&(this.activeMarks=r.addToSet(this.activeMarks),this.pendingMarks=r.removeFromSet(this.pendingMarks))}};var P=function ParseContext(t,e,n){this.parser=t,this.options=e,this.isOpen=n;var r,o=e.topNode,i=wsOptionsFor(e.preserveWhitespace)|(n?4:0);r=o?new I(o.type,o.attrs,a.none,a.none,!0,e.topMatch||o.type.contentMatch,i):new I(n?null:t.schema.topNodeType,null,a.none,a.none,!0,null,i),this.nodes=[r],this.open=0,this.find=e.findPositions,this.needsBlock=!1},j={top:{configurable:!0},currentPos:{configurable:!0}};function matches(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function copy(t){var e={};for(var n in t)e[n]=t[n];return e}function markMayApply(t,e){var n=e.schema.nodes,loop=function(r){var o=n[r];if(o.allowsMarkType(t)){var i=[],scan=function(t){i.push(t);for(var n=0;n<t.edgeCount;n++){var r=t.edge(n),o=r.type,s=r.next;if(o==e)return!0;if(i.indexOf(s)<0&&scan(s))return!0}};return scan(o.contentMatch)?{v:!0}:void 0}};for(var r in n){var o=loop(r);if(o)return o.v}}j.top.get=function(){return this.nodes[this.open]},P.prototype.addDOM=function addDOM(t){if(3==t.nodeType)this.addTextNode(t);else if(1==t.nodeType){var e=t.getAttribute("style"),n=e?this.readStyles(function parseStyles(t){var e,n=/\s*([\w-]+)\s*:\s*([^;]+)/g,r=[];for(;e=n.exec(t);)r.push(e[1],e[2].trim());return r}(e)):null,r=this.top;if(null!=n)for(var o=0;o<n.length;o++)this.addPendingMark(n[o]);if(this.addElement(t),null!=n)for(var i=0;i<n.length;i++)this.removePendingMark(n[i],r)}},P.prototype.addTextNode=function addTextNode(t){var e=t.nodeValue,n=this.top;if((n.type?n.type.inlineContent:n.content.length&&n.content[0].isInline)||/[^ \t\r\n\u000c]/.test(e)){if(1&n.options)2&n.options||(e=e.replace(/\r?\n|\r/g," "));else if(e=e.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(e)&&this.open==this.nodes.length-1){var r=n.content[n.content.length-1],o=t.previousSibling;(!r||o&&"BR"==o.nodeName||r.isText&&/[ \t\r\n\u000c]$/.test(r.text))&&(e=e.slice(1))}e&&this.insertNode(this.parser.schema.text(e)),this.findInText(t)}else this.findInside(t)},P.prototype.addElement=function addElement(t){var e=t.nodeName.toLowerCase();J.hasOwnProperty(e)&&function normalizeList(t){for(var e=t.firstChild,n=null;e;e=e.nextSibling){var r=1==e.nodeType?e.nodeName.toLowerCase():null;r&&J.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):"li"==r?n=e:r&&(n=null)}}(t);var n=this.options.ruleFromNode&&this.options.ruleFromNode(t)||this.parser.matchTag(t,this);if(n?n.ignore:z.hasOwnProperty(e))this.findInside(t);else if(!n||n.skip){n&&n.skip.nodeType&&(t=n.skip);var r,o=this.top,i=this.needsBlock;if(A.hasOwnProperty(e))r=!0,o.type||(this.needsBlock=!0);else if(!t.firstChild)return void this.leafFallback(t);this.addAll(t),r&&this.sync(o),this.needsBlock=i}else this.addElementByRule(t,n)},P.prototype.leafFallback=function leafFallback(t){"BR"==t.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode("\n"))},P.prototype.readStyles=function readStyles(t){for(var e=a.none,n=0;n<t.length;n+=2){var r=this.parser.matchStyle(t[n],t[n+1],this);if(r){if(r.ignore)return null;e=this.parser.schema.marks[r.mark].create(r.attrs).addToSet(e)}}return e},P.prototype.addElementByRule=function addElementByRule(t,e){var n,r,o,i=this;e.node?(r=this.parser.schema.nodes[e.node]).isLeaf?this.insertNode(r.create(e.attrs))||this.leafFallback(t):n=this.enter(r,e.attrs,e.preserveWhitespace):(o=this.parser.schema.marks[e.mark].create(e.attrs),this.addPendingMark(o));var s=this.top;if(r&&r.isLeaf)this.findInside(t);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach((function(t){return i.insertNode(t)}));else{var a=e.contentElement;"string"==typeof a?a=t.querySelector(a):"function"==typeof a&&(a=a(t)),a||(a=t),this.findAround(t,a,!0),this.addAll(a,n)}n&&(this.sync(s),this.open--),o&&this.removePendingMark(o,s)},P.prototype.addAll=function addAll(t,e,n,r){for(var o=n||0,i=n?t.childNodes[n]:t.firstChild,s=null==r?null:t.childNodes[r];i!=s;i=i.nextSibling,++o)this.findAtPoint(t,o),this.addDOM(i),e&&A.hasOwnProperty(i.nodeName.toLowerCase())&&this.sync(e);this.findAtPoint(t,o)},P.prototype.findPlace=function findPlace(t){for(var e,n,r=this.open;r>=0;r--){var o=this.nodes[r],i=o.findWrapping(t);if(i&&(!e||e.length>i.length)&&(e=i,n=o,!i.length))break;if(o.solid)break}if(!e)return!1;this.sync(n);for(var s=0;s<e.length;s++)this.enterInner(e[s],null,!1);return!0},P.prototype.insertNode=function insertNode(t){if(t.isInline&&this.needsBlock&&!this.top.type){var e=this.textblockFromContext();e&&this.enterInner(e)}if(this.findPlace(t)){this.closeExtra();var n=this.top;n.applyPending(t.type),n.match&&(n.match=n.match.matchType(t.type));for(var r=n.activeMarks,o=0;o<t.marks.length;o++)n.type&&!n.type.allowsMarkType(t.marks[o].type)||(r=t.marks[o].addToSet(r));return n.content.push(t.mark(r)),!0}return!1},P.prototype.enter=function enter(t,e,n){var r=this.findPlace(t.create(e));return r&&this.enterInner(t,e,!0,n),r},P.prototype.enterInner=function enterInner(t,e,n,r){this.closeExtra();var o=this.top;o.applyPending(t),o.match=o.match&&o.match.matchType(t,e);var i=null==r?-5&o.options:wsOptionsFor(r);4&o.options&&0==o.content.length&&(i|=4),this.nodes.push(new I(t,e,o.activeMarks,o.pendingMarks,n,null,i)),this.open++},P.prototype.closeExtra=function closeExtra(t){var e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}},P.prototype.finish=function finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)},P.prototype.sync=function sync(t){for(var e=this.open;e>=0;e--)if(this.nodes[e]==t)return void(this.open=e)},j.currentPos.get=function(){this.closeExtra();for(var t=0,e=this.open;e>=0;e--){for(var n=this.nodes[e].content,r=n.length-1;r>=0;r--)t+=n[r].nodeSize;e&&t++}return t},P.prototype.findAtPoint=function findAtPoint(t,e){if(this.find)for(var n=0;n<this.find.length;n++)this.find[n].node==t&&this.find[n].offset==e&&(this.find[n].pos=this.currentPos)},P.prototype.findInside=function findInside(t){if(this.find)for(var e=0;e<this.find.length;e++)null==this.find[e].pos&&1==t.nodeType&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)},P.prototype.findAround=function findAround(t,e,n){if(t!=e&&this.find)for(var r=0;r<this.find.length;r++){if(null==this.find[r].pos&&1==t.nodeType&&t.contains(this.find[r].node))e.compareDocumentPosition(this.find[r].node)&(n?2:4)&&(this.find[r].pos=this.currentPos)}},P.prototype.findInText=function findInText(t){if(this.find)for(var e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))},P.prototype.matchesContext=function matchesContext(t){var e=this;if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);var n=t.split("/"),r=this.options.context,o=!(this.isOpen||r&&r.parent.type!=this.nodes[0].type),i=-(r?r.depth+1:0)+(o?0:1),match=function(t,s){for(;t>=0;t--){var a=n[t];if(""==a){if(t==n.length-1||0==t)continue;for(;s>=i;s--)if(match(t-1,s))return!0;return!1}var p=s>0||0==s&&o?e.nodes[s].type:r&&s>=i?r.node(s-i).type:null;if(!p||p.name!=a&&-1==p.groups.indexOf(a))return!1;s--}return!0};return match(n.length-1,this.open)},P.prototype.textblockFromContext=function textblockFromContext(){var t=this.options.context;if(t)for(var e=t.depth;e>=0;e--){var n=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(var r in this.parser.schema.nodes){var o=this.parser.schema.nodes[r];if(o.isTextblock&&o.defaultAttrs)return o}},P.prototype.addPendingMark=function addPendingMark(t){this.top.pendingMarks=t.addToSet(this.top.pendingMarks)},P.prototype.removePendingMark=function removePendingMark(t,e){for(var n=this.open;n>=0;n--){var r=this.nodes[n];if(r.pendingMarks.lastIndexOf(t)>-1?r.pendingMarks=t.removeFromSet(r.pendingMarks):r.activeMarks=t.removeFromSet(r.activeMarks),r==e)break}},Object.defineProperties(P.prototype,j);var F=function DOMSerializer(t,e){this.nodes=t||{},this.marks=e||{}};function gatherToDOM(t){var e={};for(var n in t){var r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function index_es_doc(t){return t.document||window.document}F.prototype.serializeFragment=function serializeFragment(t,e,n){var r=this;void 0===e&&(e={}),n||(n=index_es_doc(e).createDocumentFragment());var o=n,i=null;return t.forEach((function(t){if(i||t.marks.length){i||(i=[]);for(var n=0,s=0;n<i.length&&s<t.marks.length;){var a=t.marks[s];if(r.marks[a.type.name]){if(!a.eq(i[n])||!1===a.type.spec.spanning)break;n+=2,s++}else s++}for(;n<i.length;)o=i.pop(),i.pop();for(;s<t.marks.length;){var p=t.marks[s++],c=r.serializeMark(p,t.isInline,e);c&&(i.push(p,o),o.appendChild(c.dom),o=c.contentDOM||c.dom)}}o.appendChild(r.serializeNode(t,e))})),n},F.prototype.serializeNode=function serializeNode(t,e){void 0===e&&(e={});var n=F.renderSpec(index_es_doc(e),this.nodes[t.type.name](t)),r=n.dom,o=n.contentDOM;if(o){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");e.onContent?e.onContent(t,o,e):this.serializeFragment(t.content,e,o)}return r},F.prototype.serializeNodeAndMarks=function serializeNodeAndMarks(t,e){void 0===e&&(e={});for(var n=this.serializeNode(t,e),r=t.marks.length-1;r>=0;r--){var o=this.serializeMark(t.marks[r],t.isInline,e);o&&((o.contentDOM||o.dom).appendChild(n),n=o.dom)}return n},F.prototype.serializeMark=function serializeMark(t,e,n){void 0===n&&(n={});var r=this.marks[t.type.name];return r&&F.renderSpec(index_es_doc(n),r(t,e))},F.renderSpec=function renderSpec(t,e,n){if(void 0===n&&(n=null),"string"==typeof e)return{dom:t.createTextNode(e)};if(null!=e.nodeType)return{dom:e};var r=e[0],o=r.indexOf(" ");o>0&&(n=r.slice(0,o),r=r.slice(o+1));var i=null,s=n?t.createElementNS(n,r):t.createElement(r),a=e[1],p=1;if(a&&"object"==typeof a&&null==a.nodeType&&!Array.isArray(a))for(var c in p=2,a)if(null!=a[c]){var h=c.indexOf(" ");h>0?s.setAttributeNS(c.slice(0,h),c.slice(h+1),a[c]):s.setAttribute(c,a[c])}for(var f=p;f<e.length;f++){var u=e[f];if(0===u){if(f<e.length-1||f>p)throw new RangeError("Content hole must be the only child of its parent node");return{dom:s,contentDOM:s}}var l=F.renderSpec(t,u,n),d=l.dom,m=l.contentDOM;if(s.appendChild(d),m){if(i)throw new RangeError("Multiple content holes");i=m}}return{dom:s,contentDOM:i}},F.fromSchema=function fromSchema(t){return t.cached.domSerializer||(t.cached.domSerializer=new F(this.nodesFromSchema(t),this.marksFromSchema(t)))},F.nodesFromSchema=function nodesFromSchema(t){var e=gatherToDOM(t.nodes);return e.text||(e.text=function(t){return t.text}),e},F.marksFromSchema=function marksFromSchema(t){return gatherToDOM(t.marks)};var D=Math.pow(2,16);function recoverIndex(t){return 65535&t}var B=function MapResult(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=null),this.pos=t,this.deleted=e,this.recover=n},q=function StepMap(t,e){void 0===e&&(e=!1),this.ranges=t,this.inverted=e};q.prototype.recover=function recover(t){var e=0,n=recoverIndex(t);if(!this.inverted)for(var r=0;r<n;r++)e+=this.ranges[3*r+2]-this.ranges[3*r+1];return this.ranges[3*n]+e+function recoverOffset(t){return(t-(65535&t))/D}(t)},q.prototype.mapResult=function mapResult(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},q.prototype.map=function map(t,e){return void 0===e&&(e=1),this._map(t,e,!0)},q.prototype._map=function _map(t,e,n){for(var r=0,o=this.inverted?2:1,i=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var a=this.ranges[s]-(this.inverted?r:0);if(a>t)break;var p=this.ranges[s+o],c=this.ranges[s+i],h=a+p;if(t<=h){var f=a+r+((p?t==a?-1:t==h?1:e:e)<0?0:c);if(n)return f;var u=s/3+(t-a)*D;return new B(f,e<0?t!=a:t!=h,u)}r+=c-p}return n?t+r:new B(t+r)},q.prototype.touches=function touches(t,e){for(var n=0,r=recoverIndex(e),o=this.inverted?2:1,i=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var a=this.ranges[s]-(this.inverted?n:0);if(a>t)break;var p=this.ranges[s+o];if(t<=a+p&&s==3*r)return!0;n+=this.ranges[s+i]-p}return!1},q.prototype.forEach=function forEach(t){for(var e=this.inverted?2:1,n=this.inverted?1:2,r=0,o=0;r<this.ranges.length;r+=3){var i=this.ranges[r],s=i-(this.inverted?o:0),a=i+(this.inverted?0:o),p=this.ranges[r+e],c=this.ranges[r+n];t(s,s+p,a,a+c),o+=c-p}},q.prototype.invert=function invert(){return new q(this.ranges,!this.inverted)},q.prototype.toString=function toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)},q.offset=function offset(t){return 0==t?q.empty:new q(t<0?[0,-t,0]:[0,0,t])},q.empty=new q([]);var W=function Mapping(t,e,n,r){this.maps=t||[],this.from=n||0,this.to=null==r?this.maps.length:r,this.mirror=e};function TransformError(t){var e=Error.call(this,t);return e.__proto__=TransformError.prototype,e}W.prototype.slice=function slice(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.maps.length),new W(this.maps,this.mirror,t,e)},W.prototype.copy=function copy(){return new W(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)},W.prototype.appendMap=function appendMap(t,e){this.to=this.maps.push(t),null!=e&&this.setMirror(this.maps.length-1,e)},W.prototype.appendMapping=function appendMapping(t){for(var e=0,n=this.maps.length;e<t.maps.length;e++){var r=t.getMirror(e);this.appendMap(t.maps[e],null!=r&&r<e?n+r:null)}},W.prototype.getMirror=function getMirror(t){if(this.mirror)for(var e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]},W.prototype.setMirror=function setMirror(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)},W.prototype.appendMappingInverted=function appendMappingInverted(t){for(var e=t.maps.length-1,n=this.maps.length+t.maps.length;e>=0;e--){var r=t.getMirror(e);this.appendMap(t.maps[e].invert(),null!=r&&r>e?n-r-1:null)}},W.prototype.invert=function invert(){var t=new W;return t.appendMappingInverted(this),t},W.prototype.map=function map(t,e){if(void 0===e&&(e=1),this.mirror)return this._map(t,e,!0);for(var n=this.from;n<this.to;n++)t=this.maps[n].map(t,e);return t},W.prototype.mapResult=function mapResult(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},W.prototype._map=function _map(t,e,n){for(var r=!1,o=null,i=this.from;i<this.to;i++){var s=this.maps[i],a=o&&o[i];if(null!=a&&s.touches(t,a))t=s.recover(a);else{var p=s.mapResult(t,e);if(null!=p.recover){var c=this.getMirror(i);if(null!=c&&c>i&&c<this.to){if(p.deleted){i=c,t=this.maps[c].recover(p.recover);continue}(o||(o=Object.create(null)))[c]=p.recover}}p.deleted&&(r=!0),t=p.pos}}return n?t:new B(t,r)},TransformError.prototype=Object.create(Error.prototype),TransformError.prototype.constructor=TransformError,TransformError.prototype.name="TransformError";var L=function Transform(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new W},$={before:{configurable:!0},docChanged:{configurable:!0}};function mustOverride(){throw new Error("Override me")}$.before.get=function(){return this.docs.length?this.docs[0]:this.doc},L.prototype.step=function step(t){var e=this.maybeStep(t);if(e.failed)throw new TransformError(e.failed);return this},L.prototype.maybeStep=function maybeStep(t){var e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e},$.docChanged.get=function(){return this.steps.length>0},L.prototype.addStep=function addStep(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e},Object.defineProperties(L.prototype,$);var V=Object.create(null),U=function Step(){};U.prototype.apply=function apply(t){return mustOverride()},U.prototype.getMap=function getMap(){return q.empty},U.prototype.invert=function invert(t){return mustOverride()},U.prototype.map=function map(t){return mustOverride()},U.prototype.merge=function merge(t){return null},U.prototype.toJSON=function toJSON(){return mustOverride()},U.fromJSON=function fromJSON(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");var n=V[e.stepType];if(!n)throw new RangeError("No step type "+e.stepType+" defined");return n.fromJSON(t,e)},U.jsonID=function jsonID(t,e){if(t in V)throw new RangeError("Duplicate use of step JSON ID "+t);return V[t]=e,e.prototype.jsonID=t,e};var H=function StepResult(t,e){this.doc=t,this.failed=e};H.ok=function ok(t){return new H(t,null)},H.fail=function fail(t){return new H(null,t)},H.fromReplace=function fromReplace(t,e,n,r){try{return H.ok(t.replace(e,n,r))}catch(t){if(t instanceof ReplaceError)return H.fail(t.message);throw t}};var G=function(t){function ReplaceStep(e,n,r,o){t.call(this),this.from=e,this.to=n,this.slice=r,this.structure=!!o}return t&&(ReplaceStep.__proto__=t),ReplaceStep.prototype=Object.create(t&&t.prototype),ReplaceStep.prototype.constructor=ReplaceStep,ReplaceStep.prototype.apply=function apply(t){return this.structure&&contentBetween(t,this.from,this.to)?H.fail("Structure replace would overwrite content"):H.fromReplace(t,this.from,this.to,this.slice)},ReplaceStep.prototype.getMap=function getMap(){return new q([this.from,this.to-this.from,this.slice.size])},ReplaceStep.prototype.invert=function invert(t){return new ReplaceStep(this.from,this.from+this.slice.size,t.slice(this.from,this.to))},ReplaceStep.prototype.map=function map(t){var e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted?null:new ReplaceStep(e.pos,Math.max(e.pos,n.pos),this.slice)},ReplaceStep.prototype.merge=function merge(t){if(!(t instanceof ReplaceStep)||t.structure!=this.structure)return null;if(this.from+this.slice.size!=t.from||this.slice.openEnd||t.slice.openStart){if(t.to!=this.from||this.slice.openStart||t.slice.openEnd)return null;var e=this.slice.size+t.slice.size==0?p.empty:new p(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new ReplaceStep(t.from,this.to,e,this.structure)}var n=this.slice.size+t.slice.size==0?p.empty:new p(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new ReplaceStep(this.from,this.to+(t.to-t.from),n,this.structure)},ReplaceStep.prototype.toJSON=function toJSON(){var t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t},ReplaceStep.fromJSON=function fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new ReplaceStep(e.from,e.to,p.fromJSON(t,e.slice),!!e.structure)},ReplaceStep}(U);U.jsonID("replace",G);var Z=function(t){function ReplaceAroundStep(e,n,r,o,i,s,a){t.call(this),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=o,this.slice=i,this.insert=s,this.structure=!!a}return t&&(ReplaceAroundStep.__proto__=t),ReplaceAroundStep.prototype=Object.create(t&&t.prototype),ReplaceAroundStep.prototype.constructor=ReplaceAroundStep,ReplaceAroundStep.prototype.apply=function apply(t){if(this.structure&&(contentBetween(t,this.from,this.gapFrom)||contentBetween(t,this.gapTo,this.to)))return H.fail("Structure gap-replace would overwrite content");var e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return H.fail("Gap is not a flat range");var n=this.slice.insertAt(this.insert,e.content);return n?H.fromReplace(t,this.from,this.to,n):H.fail("Content does not fit in gap")},ReplaceAroundStep.prototype.getMap=function getMap(){return new q([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},ReplaceAroundStep.prototype.invert=function invert(t){var e=this.gapTo-this.gapFrom;return new ReplaceAroundStep(this.from,this.from+this.slice.size+e,this.from+this.insert,this.from+this.insert+e,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},ReplaceAroundStep.prototype.map=function map(t){var e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1),r=t.map(this.gapFrom,-1),o=t.map(this.gapTo,1);return e.deleted&&n.deleted||r<e.pos||o>n.pos?null:new ReplaceAroundStep(e.pos,n.pos,r,o,this.slice,this.insert,this.structure)},ReplaceAroundStep.prototype.toJSON=function toJSON(){var t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t},ReplaceAroundStep.fromJSON=function fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to||"number"!=typeof e.gapFrom||"number"!=typeof e.gapTo||"number"!=typeof e.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new ReplaceAroundStep(e.from,e.to,e.gapFrom,e.gapTo,p.fromJSON(t,e.slice),e.insert,!!e.structure)},ReplaceAroundStep}(U);function contentBetween(t,e,n){for(var r=t.resolve(e),o=n-e,i=r.depth;o>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,o--;if(o>0)for(var s=r.node(i).maybeChild(r.indexAfter(i));o>0;){if(!s||s.isLeaf)return!0;s=s.firstChild,o--}return!1}function mapFragment(t,e,n){for(var r=[],i=0;i<t.childCount;i++){var s=t.child(i);s.content.size&&(s=s.copy(mapFragment(s.content,e,s))),s.isInline&&(s=e(s,n,i)),r.push(s)}return o.fromArray(r)}U.jsonID("replaceAround",Z),L.prototype.lift=function(t,e){for(var n=t.$from,r=t.$to,i=t.depth,s=n.before(i+1),a=r.after(i+1),c=s,h=a,f=o.empty,u=0,l=i,d=!1;l>e;l--)d||n.index(l)>0?(d=!0,f=o.from(n.node(l).copy(f)),u++):c--;for(var m=o.empty,v=0,y=i,g=!1;y>e;y--)g||r.after(y+1)<r.end(y)?(g=!0,m=o.from(r.node(y).copy(m)),v++):h++;return this.step(new Z(c,h,s,a,new p(f.append(m),u,v),f.size-u,!0))},L.prototype.wrap=function(t,e){for(var n=o.empty,r=e.length-1;r>=0;r--)n=o.from(e[r].type.create(e[r].attrs,n));var i=t.start,s=t.end;return this.step(new Z(i,s,i,s,new p(n,0,0),e.length,!0))},L.prototype.setBlockType=function(t,e,n,r){var i=this;if(void 0===e&&(e=t),!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var s=this.steps.length;return this.doc.nodesBetween(t,e,(function(t,e){if(t.isTextblock&&!t.hasMarkup(n,r)&&function canChangeType(t,e,n){var r=t.resolve(e),o=r.index();return r.parent.canReplaceWith(o,o+1,n)}(i.doc,i.mapping.slice(s).map(e),n)){i.clearIncompatible(i.mapping.slice(s).map(e,1),n);var a=i.mapping.slice(s),c=a.map(e,1),h=a.map(e+t.nodeSize,1);return i.step(new Z(c,h,c+1,h-1,new p(o.from(n.create(r,null,t.marks)),0,0),1,!0)),!1}})),this},L.prototype.setNodeMarkup=function(t,e,n,r){var i=this.doc.nodeAt(t);if(!i)throw new RangeError("No node at given position");e||(e=i.type);var s=e.create(n,null,r||i.marks);if(i.isLeaf)return this.replaceWith(t,t+i.nodeSize,s);if(!e.validContent(i.content))throw new RangeError("Invalid content for node type "+e.name);return this.step(new Z(t,t+i.nodeSize,t+1,t+i.nodeSize-1,new p(o.from(s),0,0),1,!0))},L.prototype.split=function(t,e,n){void 0===e&&(e=1);for(var r=this.doc.resolve(t),i=o.empty,s=o.empty,a=r.depth,c=r.depth-e,h=e-1;a>c;a--,h--){i=o.from(r.node(a).copy(i));var f=n&&n[h];s=o.from(f?f.type.create(f.attrs,s):r.node(a).copy(s))}return this.step(new G(t,t,new p(i.append(s),e,e),!0))},L.prototype.join=function(t,e){void 0===e&&(e=1);var n=new G(t-e,t+e,p.empty,!0);return this.step(n)};var K=function(t){function AddMarkStep(e,n,r){t.call(this),this.from=e,this.to=n,this.mark=r}return t&&(AddMarkStep.__proto__=t),AddMarkStep.prototype=Object.create(t&&t.prototype),AddMarkStep.prototype.constructor=AddMarkStep,AddMarkStep.prototype.apply=function apply(t){var e=this,n=t.slice(this.from,this.to),r=t.resolve(this.from),o=r.node(r.sharedDepth(this.to)),i=new p(mapFragment(n.content,(function(t,n){return n.type.allowsMarkType(e.mark.type)?t.mark(e.mark.addToSet(t.marks)):t}),o),n.openStart,n.openEnd);return H.fromReplace(t,this.from,this.to,i)},AddMarkStep.prototype.invert=function invert(){return new Q(this.from,this.to,this.mark)},AddMarkStep.prototype.map=function map(t){var e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted||e.pos>=n.pos?null:new AddMarkStep(e.pos,n.pos,this.mark)},AddMarkStep.prototype.merge=function merge(t){if(t instanceof AddMarkStep&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from)return new AddMarkStep(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark)},AddMarkStep.prototype.toJSON=function toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},AddMarkStep.fromJSON=function fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new AddMarkStep(e.from,e.to,t.markFromJSON(e.mark))},AddMarkStep}(U);U.jsonID("addMark",K);var Q=function(t){function RemoveMarkStep(e,n,r){t.call(this),this.from=e,this.to=n,this.mark=r}return t&&(RemoveMarkStep.__proto__=t),RemoveMarkStep.prototype=Object.create(t&&t.prototype),RemoveMarkStep.prototype.constructor=RemoveMarkStep,RemoveMarkStep.prototype.apply=function apply(t){var e=this,n=t.slice(this.from,this.to),r=new p(mapFragment(n.content,(function(t){return t.mark(e.mark.removeFromSet(t.marks))})),n.openStart,n.openEnd);return H.fromReplace(t,this.from,this.to,r)},RemoveMarkStep.prototype.invert=function invert(){return new K(this.from,this.to,this.mark)},RemoveMarkStep.prototype.map=function map(t){var e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted||e.pos>=n.pos?null:new RemoveMarkStep(e.pos,n.pos,this.mark)},RemoveMarkStep.prototype.merge=function merge(t){if(t instanceof RemoveMarkStep&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from)return new RemoveMarkStep(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark)},RemoveMarkStep.prototype.toJSON=function toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},RemoveMarkStep.fromJSON=function fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new RemoveMarkStep(e.from,e.to,t.markFromJSON(e.mark))},RemoveMarkStep}(U);function replaceStep(t,e,n,r){if(void 0===n&&(n=e),void 0===r&&(r=p.empty),e==n&&!r.size)return null;var i=t.resolve(e),s=t.resolve(n);if(fitsTrivially(i,s,r))return new G(e,n,r);var a=function fitLeft(t,e){var n=function fitLeftInner(t,e,n,r){var i=o.empty,s=0,a=n[e];if(t.depth>e){var p=fitLeftInner(t,e+1,n,r||a);s=p.openEnd+1,i=o.from(t.node(e+1).copy(p.content))}a&&(i=i.append(a.content),s=a.openEnd);r&&(i=i.append(t.node(e).contentMatchAt(t.indexAfter(e)).fillBefore(o.empty,!0)),s=0);return{content:i,openEnd:s}}(t,0,e,!1),r=n.content,i=n.openEnd;return new p(r,t.depth,i||0)}(i,function index_es_placeSlice(t,e){for(var n=new X(t),r=1;e.size&&r<=3;r++){var o=n.placeSlice(e.content,e.openStart,e.openEnd,r);3==r&&o!=e&&o.size&&(r=0),e=o}for(;n.open.length;)n.closeNode();return n.placed}(i,r)),c=fitRight(i,s,a);if(!c)return null;if(a.size!=c.size&&function canMoveText(t,e,n){if(!e.parent.isTextblock)return!1;var r,o=n.openEnd?function nodeRight(t,e){for(var n=1;n<e;n++)t=t.lastChild.content;return t.lastChild}(n.content,n.openEnd):t.node(t.depth-(n.openStart-n.openEnd));if(!o.isTextblock)return!1;for(var i=e.index();i<e.parent.childCount;i++)if(!o.type.allowsMarks(e.parent.child(i).marks))return!1;n.openEnd?r=o.contentMatchAt(o.childCount):(r=o.contentMatchAt(o.childCount),n.size&&(r=r.matchFragment(n.content,n.openStart?1:0)));return(r=r.matchFragment(e.parent.content,e.index()))&&r.validEnd}(i,s,a)){for(var h=s.depth,f=s.after(h);h>1&&f==s.end(--h);)++f;var u=fitRight(i,t.resolve(f),a);if(u)return new Z(e,f,n,s.end(),u,a.size)}return c.size||e!=n?new G(e,n,c):null}function fitRightJoin(t,e,n,r,i,s,a){var p,c=t.childCount,h=c-(a>0?1:0),f=s<0?e:n.node(i);p=s<0?f.contentMatchAt(h):1==c&&a>0?f.contentMatchAt(s?n.index(i):n.indexAfter(i)):f.contentMatchAt(n.indexAfter(i)).matchFragment(t,c>0&&s?1:0,h);var u=r.node(i);if(a>0&&i<r.depth){var l=u.content.cutByIndex(r.indexAfter(i)).addToStart(t.lastChild),d=p.fillBefore(l,!0);if(d&&d.size&&s>0&&1==c&&(d=null),d){var m=fitRightJoin(t.lastChild.content,t.lastChild,n,r,i+1,1==c?s-1:-1,a-1);if(m){var v=t.lastChild.copy(m);return d.size?t.cutByIndex(0,c-1).append(d).addToEnd(v):t.replaceChild(c-1,v)}}}a>0&&(p=p.matchType((1==c&&s>0?n.node(i+1):t.lastChild).type));var y=r.index(i);if(y==u.childCount&&!u.type.compatibleContent(e.type))return null;for(var g=p.fillBefore(u.content,!0,y),S=y;g&&S<u.content.childCount;S++)f.type.allowsMarks(u.content.child(S).marks)||(g=null);if(!g)return null;if(a>0){var x=function fitRightClosed(t,e,n,r,i){var s,a=t.content,p=a.childCount;s=i>=0?n.node(r).contentMatchAt(n.indexAfter(r)).matchFragment(a,i>0?1:0,p):t.contentMatchAt(p);if(e>0){var c=fitRightClosed(a.lastChild,e-1,n,r+1,1==p?i-1:-1);a=a.replaceChild(p-1,c)}return t.copy(a.append(s.fillBefore(o.empty,!0)))}(t.lastChild,a-1,n,i+1,1==c?s-1:-1);t=t.replaceChild(c-1,x)}return t=t.append(g),r.depth>i&&(t=t.addToEnd(function fitRightSeparate(t,e){var n=t.node(e),r=n.contentMatchAt(0).fillBefore(n.content,!0,t.index(e));t.depth>e&&(r=r.addToEnd(fitRightSeparate(t,e+1)));return n.copy(r)}(r,i+1))),t}function fitRight(t,e,n){var r=fitRightJoin(n.content,t.node(0),t,e,0,n.openStart,n.openEnd);return r?function normalizeSlice(t,e,n){for(;e>0&&n>0&&1==t.childCount;)t=t.firstChild.content,e--,n--;return new p(t,e,n)}(r,n.openStart,e.depth):null}function fitsTrivially(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}U.jsonID("removeMark",Q),L.prototype.addMark=function(t,e,n){var r=this,o=[],i=[],s=null,a=null;return this.doc.nodesBetween(t,e,(function(r,p,c){if(r.isInline){var h=r.marks;if(!n.isInSet(h)&&c.type.allowsMarkType(n.type)){for(var f=Math.max(p,t),u=Math.min(p+r.nodeSize,e),l=n.addToSet(h),d=0;d<h.length;d++)h[d].isInSet(l)||(s&&s.to==f&&s.mark.eq(h[d])?s.to=u:o.push(s=new Q(f,u,h[d])));a&&a.to==f?a.to=u:i.push(a=new K(f,u,n))}}})),o.forEach((function(t){return r.step(t)})),i.forEach((function(t){return r.step(t)})),this},L.prototype.removeMark=function(t,e,n){var r=this;void 0===n&&(n=null);var o=[],i=0;return this.doc.nodesBetween(t,e,(function(r,s){if(r.isInline){i++;var a=null;if(n instanceof C){var p=n.isInSet(r.marks);p&&(a=[p])}else n?n.isInSet(r.marks)&&(a=[n]):a=r.marks;if(a&&a.length)for(var c=Math.min(s+r.nodeSize,e),h=0;h<a.length;h++){for(var f=a[h],u=void 0,l=0;l<o.length;l++){var d=o[l];d.step==i-1&&f.eq(o[l].style)&&(u=d)}u?(u.to=c,u.step=i):o.push({style:f,from:Math.max(s,t),to:c,step:i})}}})),o.forEach((function(t){return r.step(new Q(t.from,t.to,t.style))})),this},L.prototype.clearIncompatible=function(t,e,n){void 0===n&&(n=e.contentMatch);for(var r=this.doc.nodeAt(t),i=[],s=t+1,a=0;a<r.childCount;a++){var c=r.child(a),h=s+c.nodeSize,f=n.matchType(c.type,c.attrs);if(f){n=f;for(var u=0;u<c.marks.length;u++)e.allowsMarkType(c.marks[u].type)||this.step(new Q(s,h,c.marks[u]))}else i.push(new G(s,h,p.empty));s=h}if(!n.validEnd){var l=n.fillBefore(o.empty,!0);this.replace(s,s,new p(l,0,0))}for(var d=i.length-1;d>=0;d--)this.step(i[d]);return this},L.prototype.replace=function(t,e,n){void 0===e&&(e=t),void 0===n&&(n=p.empty);var r=replaceStep(this.doc,t,e,n);return r&&this.step(r),this},L.prototype.replaceWith=function(t,e,n){return this.replace(t,e,new p(o.from(n),0,0))},L.prototype.delete=function(t,e){return this.replace(t,e,p.empty)},L.prototype.insert=function(t,e){return this.replaceWith(t,t,e)};var X=function Frontier(t){this.open=[];for(var e=0;e<=t.depth;e++){var n=t.node(e),r=n.contentMatchAt(t.indexAfter(e));this.open.push({parent:n,match:r,content:o.empty,wrapper:!1,openEnd:0,depth:e})}this.placed=[]};function closeNodeStart(t,e,n){var r=t.content;if(e>1){var o=closeNodeStart(t.firstChild,e-1,1==t.childCount?n-1:0);r=t.content.replaceChild(0,o)}var i=t.type.contentMatch.fillBefore(r,0==n);return t.copy(i.append(r))}function closeFragment(t,e,n,r,i){if(e<n){var s=t.firstChild;t=t.replaceChild(0,s.copy(closeFragment(s.content,e+1,n,r,s)))}if(e>r){var a=i.contentMatchAt(0),p=a.fillBefore(t).append(t);t=p.append(a.matchFragment(p).fillBefore(o.empty,!0))}return t}function coveredDepths(t,e){for(var n=[],r=Math.min(t.depth,e.depth);r>=0;r--){var o=t.start(r);if(o<t.pos-(t.depth-r)||e.end(r)>e.pos+(e.depth-r)||t.node(r).type.spec.isolating||e.node(r).type.spec.isolating)break;o==e.start(r)&&n.push(r)}return n}X.prototype.placeSlice=function placeSlice(t,e,n,r,i){if(e>0){var s=t.firstChild,a=this.placeSlice(s.content,Math.max(0,e-1),n&&1==t.childCount?n-1:0,r,s);a.content!=s.content&&(a.content.size?(t=t.replaceChild(0,s.copy(a.content)),e=a.openStart+1):(1==t.childCount&&(n=0),t=t.cutByIndex(1),e=0))}var c=this.placeContent(t,e,n,r,i);if(r>2&&c.size&&0==e){var h=c.content.firstChild,f=1==c.content.childCount;this.placeContent(h.content,0,n&&f?n-1:0,r,h),c=f?o.empty:new p(c.content.cutByIndex(1),0,n)}return c},X.prototype.placeContent=function placeContent(t,e,n,r,i){for(var s=0;s<t.childCount;s++){for(var a=t.child(s),c=!1,h=s==t.childCount-1,f=this.open.length-1;f>=0;f--){var u=this.open[f],l=void 0;if(r>1&&(l=u.match.findWrapping(a.type))&&(!i||!l.length||l[l.length-1]!=i.type)){for(;this.open.length-1>f;)this.closeNode();for(var d=0;d<l.length;d++)u.match=u.match.matchType(l[d]),f++,u={parent:l[d].create(),match:l[d].contentMatch,content:o.empty,wrapper:!0,openEnd:0,depth:f+d},this.open.push(u)}var m=u.match.matchType(a.type);if(!m){var v=u.match.fillBefore(o.from(a));if(!v){if(i&&u.match.matchType(i.type))break;continue}for(var y=0;y<v.childCount;y++){var g=v.child(y);this.addNode(u,g,0),m=u.match.matchFragment(g)}}for(;this.open.length-1>f;)this.closeNode();a=a.mark(u.parent.type.allowedMarks(a.marks)),e&&(a=closeNodeStart(a,e,h?n:0),e=0),this.addNode(u,a,h?n:0),u.match=m,h&&(n=0),c=!0;break}if(!c)break}return this.open.length>1&&(s>0&&s==t.childCount||i&&this.open[this.open.length-1].parent.type==i.type)&&this.closeNode(),new p(t.cutByIndex(s),e,n)},X.prototype.addNode=function addNode(t,e,n){t.content=function closeFragmentEnd(t,e){return e?t.replaceChild(t.childCount-1,function closeNodeEnd(t,e){var n=t.content;if(e>1){var r=closeNodeEnd(t.lastChild,e-1);n=t.content.replaceChild(t.childCount-1,r)}var i=t.contentMatchAt(t.childCount).fillBefore(o.empty,!0);return t.copy(n.append(i))}(t.lastChild,e)):t}(t.content,t.openEnd).addToEnd(e),t.openEnd=n},X.prototype.closeNode=function closeNode(){var t=this.open.pop();0==t.content.size||(t.wrapper?this.addNode(this.open[this.open.length-1],t.parent.copy(t.content),t.openEnd+1):this.placed[t.depth]={depth:t.depth,content:t.content,openEnd:t.openEnd})},L.prototype.replaceRange=function(t,e,n){if(!n.size)return this.deleteRange(t,e);var r=this.doc.resolve(t),o=this.doc.resolve(e);if(fitsTrivially(r,o,n))return this.step(new G(t,e,n));var i=coveredDepths(r,this.doc.resolve(e));0==i[i.length-1]&&i.pop();var s=-(r.depth+1);i.unshift(s);for(var a=r.depth,c=r.pos-1;a>0;a--,c--){var h=r.node(a).type.spec;if(h.defining||h.isolating)break;i.indexOf(a)>-1?s=a:r.before(a)==c&&i.splice(1,0,-a)}for(var f=i.indexOf(s),u=[],l=n.openStart,d=n.content,m=0;;m++){var v=d.firstChild;if(u.push(v),m==n.openStart)break;d=v.content}l>0&&u[l-1].type.spec.defining&&r.node(f).type!=u[l-1].type?l-=1:l>=2&&u[l-1].isTextblock&&u[l-2].type.spec.defining&&r.node(f).type!=u[l-2].type&&(l-=2);for(var y=n.openStart;y>=0;y--){var g=(y+l+1)%(n.openStart+1),S=u[g];if(S)for(var x=0;x<i.length;x++){var k=i[(x+f)%i.length],w=!0;k<0&&(w=!1,k=-k);var b=r.node(k-1),O=r.index(k-1);if(b.canReplaceWith(O,O,S.type,S.marks))return this.replace(r.before(k),w?o.after(k):e,new p(closeFragment(n.content,0,n.openStart,g),g,n.openEnd))}}for(var M=this.steps.length,N=i.length-1;N>=0&&(this.replace(t,e,n),!(this.steps.length>M));N--){var E=i[N];N<0||(t=r.before(E),e=o.after(E))}return this},L.prototype.replaceRangeWith=function(t,e,n){if(!n.isInline&&t==e&&this.doc.resolve(t).parent.content.size){var r=function insertPoint(t,e,n){var r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(0==r.parentOffset)for(var o=r.depth-1;o>=0;o--){var i=r.index(o);if(r.node(o).canReplaceWith(i,i,n))return r.before(o+1);if(i>0)return null}if(r.parentOffset==r.parent.content.size)for(var s=r.depth-1;s>=0;s--){var a=r.indexAfter(s);if(r.node(s).canReplaceWith(a,a,n))return r.after(s+1);if(a<r.node(s).childCount)return null}}(this.doc,t,n.type);null!=r&&(t=e=r)}return this.replaceRange(t,e,new p(o.from(n),0,0))},L.prototype.deleteRange=function(t,e){for(var n=this.doc.resolve(t),r=this.doc.resolve(e),o=coveredDepths(n,r),i=0;i<o.length;i++){var s=o[i],a=i==o.length-1;if(a&&0==s||n.node(s).type.contentMatch.validEnd)return this.delete(n.start(s),r.end(s));if(s>0&&(a||n.node(s-1).canReplace(n.index(s-1),r.indexAfter(s-1))))return this.delete(n.before(s),r.after(s))}for(var p=1;p<=n.depth&&p<=r.depth;p++)if(t-n.start(p)==n.depth-p&&e>n.end(p)&&r.end(p)-e!=r.depth-p)return this.delete(n.before(p),e);return this.delete(t,e)};var Y=n(0);function Diff(){}function buildValues(t,e,n,r,o){for(var i=0,s=e.length,a=0,p=0;i<s;i++){var c=e[i];if(c.removed){if(c.value=t.join(r.slice(p,p+c.count)),p+=c.count,i&&e[i-1].added){var h=e[i-1];e[i-1]=e[i],e[i]=h}}else{if(!c.added&&o){var f=n.slice(a,a+c.count);f=f.map((function(t,e){var n=r[p+e];return n.length>t.length?n:t})),c.value=t.join(f)}else c.value=t.join(n.slice(a,a+c.count));a+=c.count,c.added||(p+=c.count)}}var u=e[s-1];return s>1&&"string"==typeof u.value&&(u.added||u.removed)&&t.equals("",u.value)&&(e[s-2].value+=u.value,e.pop()),e}function clonePath(t){return{newPos:t.newPos,components:t.components.slice(0)}}Diff.prototype={diff:function diff(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.callback;"function"==typeof n&&(r=n,n={}),this.options=n;var o=this;function done(t){return r?(setTimeout((function(){r(void 0,t)}),0),!0):t}t=this.castInput(t),e=this.castInput(e),t=this.removeEmpty(this.tokenize(t));var i=(e=this.removeEmpty(this.tokenize(e))).length,s=t.length,a=1,p=i+s,c=[{newPos:-1,components:[]}],h=this.extractCommon(c[0],e,t,0);if(c[0].newPos+1>=i&&h+1>=s)return done([{value:this.join(e),count:e.length}]);function execEditLength(){for(var n=-1*a;n<=a;n+=2){var r=void 0,p=c[n-1],h=c[n+1],f=(h?h.newPos:0)-n;p&&(c[n-1]=void 0);var u=p&&p.newPos+1<i,l=h&&0<=f&&f<s;if(u||l){if(!u||l&&p.newPos<h.newPos?(r=clonePath(h),o.pushComponent(r.components,void 0,!0)):((r=p).newPos++,o.pushComponent(r.components,!0,void 0)),f=o.extractCommon(r,e,t,n),r.newPos+1>=i&&f+1>=s)return done(buildValues(o,r.components,e,t,o.useLongestToken));c[n]=r}else c[n]=void 0}a++}if(r)!function exec(){setTimeout((function(){if(a>p)return r();execEditLength()||exec()}),0)}();else for(;a<=p;){var f=execEditLength();if(f)return f}},pushComponent:function pushComponent(t,e,n){var r=t[t.length-1];r&&r.added===e&&r.removed===n?t[t.length-1]={count:r.count+1,added:e,removed:n}:t.push({count:1,added:e,removed:n})},extractCommon:function extractCommon(t,e,n,r){for(var o=e.length,i=n.length,s=t.newPos,a=s-r,p=0;s+1<o&&a+1<i&&this.equals(e[s+1],n[a+1]);)s++,a++,p++;return p&&t.components.push({count:p}),t.newPos=s,a},equals:function equals(t,e){return this.options.comparator?this.options.comparator(t,e):t===e||this.options.ignoreCase&&t.toLowerCase()===e.toLowerCase()},removeEmpty:function removeEmpty(t){for(var e=[],n=0;n<t.length;n++)t[n]&&e.push(t[n]);return e},castInput:function castInput(t){return t},tokenize:function tokenize(t){return t.split("")},join:function join(t){return t.join("")}};var tt=new Diff;var et=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,nt=/\S/,rt=new Diff;rt.equals=function(t,e){return this.options.ignoreCase&&(t=t.toLowerCase(),e=e.toLowerCase()),t===e||this.options.ignoreWhitespace&&!nt.test(t)&&!nt.test(e)},rt.tokenize=function(t){for(var e=t.split(/(\s+|[()[\]{}'"]|\b)/),n=0;n<e.length-1;n++)!e[n+1]&&e[n+2]&&et.test(e[n])&&et.test(e[n+2])&&(e[n]+=e[n+2],e.splice(n+1,2),n--);return e};var ot=new Diff;ot.tokenize=function(t){var e=[],n=t.split(/(\n|\r\n)/);n[n.length-1]||n.pop();for(var r=0;r<n.length;r++){var o=n[r];r%2&&!this.options.newlineIsToken?e[e.length-1]+=o:(this.options.ignoreWhitespace&&(o=o.trim()),e.push(o))}return e};var it=new Diff;it.tokenize=function(t){return t.split(/(\S.+?[.!?])(?=\s+|$)/)};var st=new Diff;function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}st.tokenize=function(t){return t.split(/([{}:;,]|\s+)/)};var at=Object.prototype.toString,pt=new Diff;pt.useLongestToken=!0,pt.tokenize=ot.tokenize,pt.castInput=function(t){var e=this.options,n=e.undefinedReplacement,r=e.stringifyReplacer,o=void 0===r?function(t,e){return void 0===e?n:e}:r;return"string"==typeof t?t:JSON.stringify(function canonicalize(t,e,n,r,o){e=e||[],n=n||[],r&&(t=r(o,t));var i,s;for(i=0;i<e.length;i+=1)if(e[i]===t)return n[i];if("[object Array]"===at.call(t)){for(e.push(t),s=new Array(t.length),n.push(s),i=0;i<t.length;i+=1)s[i]=canonicalize(t[i],e,n,r,o);return e.pop(),n.pop(),s}t&&t.toJSON&&(t=t.toJSON());if("object"===_typeof(t)&&null!==t){e.push(t),s={},n.push(s);var a,p=[];for(a in t)t.hasOwnProperty(a)&&p.push(a);for(p.sort(),i=0;i<p.length;i+=1)a=p[i],s[a]=canonicalize(t[a],e,n,r,a);e.pop(),n.pop()}else s=t;return s}(t,null,null,o),o,"  ")},pt.equals=function(t,e){return Diff.prototype.equals.call(pt,t.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"))};var ct=new Diff;function getReplaceStep(t,e){let n=e.content.findDiffStart(t.content);if(null===n)return!1;let{a:r,b:o}=e.content.findDiffEnd(t.content);const i=n-Math.min(r,o);return i>0&&(t.resolve(n-i).depth<e.resolve(r+i).depth?n-=i:(r+=i,o+=i)),new G(n,o,e.slice(n,r))}function removeMarks(t){const e=new L(t);return e.removeMark(0,t.nodeSize-2),e.doc}function copy_copy(t){return JSON.parse(JSON.stringify(t))}ct.tokenize=function(t){return t.slice()},ct.join=ct.removeEmpty=function(t){return t};class recreateTransform_RecreateTransform{constructor(t,e,n={}){const r=Object.assign({complexSteps:!0,wordDiffs:!1,simplifyDiff:!0},n);this.fromDoc=t,this.toDoc=e,this.complexSteps=r.complexSteps,this.wordDiffs=r.wordDiffs,this.simplifyDiff=r.simplifyDiff,this.schema=t.type.schema,this.tr=new L(t)}init(){return this.complexSteps?(this.currentJSON=removeMarks(this.fromDoc).toJSON(),this.finalJSON=removeMarks(this.toDoc).toJSON(),this.ops=Object(Y.createPatch)(this.currentJSON,this.finalJSON),this.recreateChangeContentSteps(),this.recreateChangeMarkSteps()):(this.currentJSON=this.fromDoc.toJSON(),this.finalJSON=this.toDoc.toJSON(),this.ops=Object(Y.createPatch)(this.currentJSON,this.finalJSON),this.recreateChangeContentSteps()),this.simplifyDiff&&(this.tr=function simplifyTransform(t){if(!t.steps.length)return;const e=new L(t.docs[0]),n=t.steps.slice();for(;n.length;){let t=n.shift();for(;n.length&&t.merge(n[0]);){const r=n.shift();t=t instanceof G&&r instanceof G?getReplaceStep(e.doc,r.apply(t.apply(e.doc).doc).doc):t.merge(r)}e.step(t)}return e}(this.tr)||this.tr),this.tr}recreateChangeContentSteps(){let t=[];for(;this.ops.length;){let e,n=this.ops.shift();t.push(n);const r=copy_copy(this.currentJSON),o=n.path.split("/");for(;null==e;){Object(Y.applyPatch)(r,[n]);try{e=this.schema.nodeFromJSON(r),e.check()}catch(r){if(e=null,!(this.ops.length>0))throw new Error(`No valid diff possible applying ${n.path}`);n=this.ops.shift(),t.push(n)}}this.complexSteps&&1===t.length&&(o.includes("attrs")||o.includes("type"))?(this.addSetNodeMarkup(),t=[]):1===t.length&&"replace"===n.op&&"text"===o[o.length-1]?(this.addReplaceTextSteps(n,r),t=[]):this.addReplaceStep(e,r)&&(t=[])}}addSetNodeMarkup(){const t=this.schema.nodeFromJSON(this.currentJSON),e=this.schema.nodeFromJSON(this.finalJSON),n=e.content.findDiffStart(t.content),r=t.nodeAt(n),o=e.nodeAt(n);if(null!=n){const t=r.type===o.type?null:o.type;return this.tr.setNodeMarkup(n,t,o.attrs,o.marks),this.currentJSON=removeMarks(this.tr.doc).toJSON(),this.ops=Object(Y.createPatch)(this.currentJSON,this.finalJSON),!0}return!1}recreateChangeMarkSteps(){this.toDoc.descendants((t,e)=>{if(!t.isInline)return!0;this.tr.doc.nodesBetween(e,e+t.nodeSize,(n,r)=>{if(!n.isInline)return!0;const o=Math.max(e,r),i=Math.min(e+t.nodeSize,r+n.nodeSize);n.marks.forEach(e=>{e.isInSet(t.marks)||this.tr.removeMark(o,i,e)}),t.marks.forEach(t=>{t.isInSet(n.marks)||this.tr.addMark(o,i,t)})})})}addReplaceStep(t,e){const n=getReplaceStep(this.schema.nodeFromJSON(this.currentJSON),t);if(!n)return!1;if(!this.tr.maybeStep(n).failed)return this.currentJSON=e,!0;throw new Error("No valid step found.")}addReplaceTextSteps(t,e){const n=Object.assign(Object.assign({},t),{value:"xx"}),r=Object.assign(Object.assign({},t),{value:"yy"}),o=copy_copy(this.currentJSON),i=copy_copy(this.currentJSON);Object(Y.applyPatch)(o,[n]),Object(Y.applyPatch)(i,[r]);const s=this.schema.nodeFromJSON(o),a=this.schema.nodeFromJSON(i),p=t.value,c=function getFromPath(t,e){const n=e.split("/");for(n.shift();n.length;){t=t[n.shift()]}return t}(this.currentJSON,t.path),h=this.wordDiffs?function diffWordsWithSpace(t,e,n){return rt.diff(t,e,n)}(c,p):function diffChars(t,e,n){return tt.diff(t,e,n)}(c,p);let f=s.content.findDiffStart(a.content);const u=s.resolve(f+1).marks();for(;h.length;){const t=h.shift();if(t.added){const e=this.schema.nodeFromJSON({type:"text",text:t.value}).mark(u);if(h.length&&h[0].removed){const t=h.shift();this.tr.replaceWith(f,f+t.value.length,e)}else this.tr.insert(f,e);f+=t.value.length}else if(t.removed)if(h.length&&h[0].added){const e=h.shift(),n=this.schema.nodeFromJSON({type:"text",text:e.value}).mark(u);this.tr.replaceWith(f,f+t.value.length,n),f+=e.value.length}else this.tr.delete(f,f+t.value.length);else f+=t.value.length}this.currentJSON=e}}function recreateTransform(t,e,n={}){return new recreateTransform_RecreateTransform(t,e,n).init()}}])}));
//# sourceMappingURL=recreateTransform.js.map