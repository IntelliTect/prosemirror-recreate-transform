!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.recreateTransform=e():t.recreateTransform=e()}(window,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=4)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),o=n(5),i=n(7);function s(t,e){var n=r.Pointer.fromJSON(e).evaluate(t);if(void 0!==n)return{op:"test",path:e,value:n.value}}e.applyPatch=function(t,e){return e.map((function(e){return o.apply(t,e)}))},e.createPatch=function(t,e,n){var o=new r.Pointer;return(n?function(t){return function e(n,r,o){var s=t(n,r,o);return Array.isArray(s)?s:i.diffAny(n,r,o,e)}}(n):i.diffAny)(t,e,o)},e.createTests=function(t,e){var n=new Array;return e.filter(i.isDestructive).forEach((function(e){var r=s(t,e.path);if(r&&n.push(r),"from"in e){var o=s(t,e.from);o&&n.push(o)}})),n}},function(t,e,n){
/*!

 diff v4.0.1

Software License Agreement (BSD License)

Copyright (c) 2009-2015, Kevin Decker <kpdecker@gmail.com>

All rights reserved.

Redistribution and use of this software in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

* Redistributions of source code must retain the above
  copyright notice, this list of conditions and the
  following disclaimer.

* Redistributions in binary form must reproduce the above
  copyright notice, this list of conditions and the
  following disclaimer in the documentation and/or other
  materials provided with the distribution.

* Neither the name of Kevin Decker nor the names of its
  contributors may be used to endorse or promote products
  derived from this software without specific prior
  written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR
IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER
IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
@license
*/
!function(t){"use strict";function e(){}function n(t,e,n,r,o){for(var i=0,s=e.length,a=0,l=0;i<s;i++){var u=e[i];if(u.removed){if(u.value=t.join(r.slice(l,l+u.count)),l+=u.count,i&&e[i-1].added){var c=e[i-1];e[i-1]=e[i],e[i]=c}}else{if(!u.added&&o){var p=n.slice(a,a+u.count);p=p.map((function(t,e){var n=r[l+e];return n.length>t.length?n:t})),u.value=t.join(p)}else u.value=t.join(n.slice(a,a+u.count));a+=u.count,u.added||(l+=u.count)}}var h=e[s-1];return s>1&&"string"==typeof h.value&&(h.added||h.removed)&&t.equals("",h.value)&&(e[s-2].value+=h.value,e.pop()),e}function r(t){return{newPos:t.newPos,components:t.components.slice(0)}}e.prototype={diff:function(t,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=o.callback;"function"==typeof o&&(i=o,o={}),this.options=o;var s=this;function a(t){return i?(setTimeout((function(){i(void 0,t)}),0),!0):t}t=this.castInput(t),e=this.castInput(e),t=this.removeEmpty(this.tokenize(t));var l=(e=this.removeEmpty(this.tokenize(e))).length,u=t.length,c=1,p=l+u,h=[{newPos:-1,components:[]}],f=this.extractCommon(h[0],e,t,0);if(h[0].newPos+1>=l&&f+1>=u)return a([{value:this.join(e),count:e.length}]);function d(){for(var o=-1*c;o<=c;o+=2){var i=void 0,p=h[o-1],f=h[o+1],d=(f?f.newPos:0)-o;p&&(h[o-1]=void 0);var m=p&&p.newPos+1<l,v=f&&0<=d&&d<u;if(m||v){if(!m||v&&p.newPos<f.newPos?(i=r(f),s.pushComponent(i.components,void 0,!0)):((i=p).newPos++,s.pushComponent(i.components,!0,void 0)),d=s.extractCommon(i,e,t,o),i.newPos+1>=l&&d+1>=u)return a(n(s,i.components,e,t,s.useLongestToken));h[o]=i}else h[o]=void 0}c++}if(i)!function t(){setTimeout((function(){if(c>p)return i();d()||t()}),0)}();else for(;c<=p;){var m=d();if(m)return m}},pushComponent:function(t,e,n){var r=t[t.length-1];r&&r.added===e&&r.removed===n?t[t.length-1]={count:r.count+1,added:e,removed:n}:t.push({count:1,added:e,removed:n})},extractCommon:function(t,e,n,r){for(var o=e.length,i=n.length,s=t.newPos,a=s-r,l=0;s+1<o&&a+1<i&&this.equals(e[s+1],n[a+1]);)s++,a++,l++;return l&&t.components.push({count:l}),t.newPos=s,a},equals:function(t,e){return this.options.comparator?this.options.comparator(t,e):t===e||this.options.ignoreCase&&t.toLowerCase()===e.toLowerCase()},removeEmpty:function(t){for(var e=[],n=0;n<t.length;n++)t[n]&&e.push(t[n]);return e},castInput:function(t){return t},tokenize:function(t){return t.split("")},join:function(t){return t.join("")}};var o=new e;function i(t,e){if("function"==typeof t)e.callback=t;else if(t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}var s=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,a=/\S/,l=new e;l.equals=function(t,e){return this.options.ignoreCase&&(t=t.toLowerCase(),e=e.toLowerCase()),t===e||this.options.ignoreWhitespace&&!a.test(t)&&!a.test(e)},l.tokenize=function(t){for(var e=t.split(/(\s+|[()[\]{}'"]|\b)/),n=0;n<e.length-1;n++)!e[n+1]&&e[n+2]&&s.test(e[n])&&s.test(e[n+2])&&(e[n]+=e[n+2],e.splice(n+1,2),n--);return e};var u=new e;function c(t,e,n){return u.diff(t,e,n)}u.tokenize=function(t){var e=[],n=t.split(/(\n|\r\n)/);n[n.length-1]||n.pop();for(var r=0;r<n.length;r++){var o=n[r];r%2&&!this.options.newlineIsToken?e[e.length-1]+=o:(this.options.ignoreWhitespace&&(o=o.trim()),e.push(o))}return e};var p=new e;p.tokenize=function(t){return t.split(/(\S.+?[.!?])(?=\s+|$)/)};var h=new e;function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function d(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}h.tokenize=function(t){return t.split(/([{}:;,]|\s+)/)};var m=Object.prototype.toString,v=new e;function y(t,e,n,r,o){var i,s;for(e=e||[],n=n||[],r&&(t=r(o,t)),i=0;i<e.length;i+=1)if(e[i]===t)return n[i];if("[object Array]"===m.call(t)){for(e.push(t),s=new Array(t.length),n.push(s),i=0;i<t.length;i+=1)s[i]=y(t[i],e,n,r,o);return e.pop(),n.pop(),s}if(t&&t.toJSON&&(t=t.toJSON()),"object"===f(t)&&null!==t){e.push(t),s={},n.push(s);var a,l=[];for(a in t)t.hasOwnProperty(a)&&l.push(a);for(l.sort(),i=0;i<l.length;i+=1)s[a=l[i]]=y(t[a],e,n,r,a);e.pop(),n.pop()}else s=t;return s}v.useLongestToken=!0,v.tokenize=u.tokenize,v.castInput=function(t){var e=this.options,n=e.undefinedReplacement,r=e.stringifyReplacer,o=void 0===r?function(t,e){return void 0===e?n:e}:r;return"string"==typeof t?t:JSON.stringify(y(t,null,null,o),o,"  ")},v.equals=function(t,n){return e.prototype.equals.call(v,t.replace(/,([\r\n])/g,"$1"),n.replace(/,([\r\n])/g,"$1"))};var g=new e;function w(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.split(/\r\n|[\n\v\f\r\x85]/),r=t.match(/\r\n|[\n\v\f\r\x85]/g)||[],o=[],i=0;function s(){var t={};for(o.push(t);i<n.length;){var r=n[i];if(/^(\-\-\-|\+\+\+|@@)\s/.test(r))break;var s=/^(?:Index:|diff(?: -r \w+)+)\s+(.+?)\s*$/.exec(r);s&&(t.index=s[1]),i++}for(a(t),a(t),t.hunks=[];i<n.length;){var u=n[i];if(/^(Index:|diff|\-\-\-|\+\+\+)\s/.test(u))break;if(/^@@/.test(u))t.hunks.push(l());else{if(u&&e.strict)throw new Error("Unknown line "+(i+1)+" "+JSON.stringify(u));i++}}}function a(t){var e=/^(---|\+\+\+)\s+(.*)$/.exec(n[i]);if(e){var r="---"===e[1]?"old":"new",o=e[2].split("\t",2),s=o[0].replace(/\\\\/g,"\\");/^".*"$/.test(s)&&(s=s.substr(1,s.length-2)),t[r+"FileName"]=s,t[r+"Header"]=(o[1]||"").trim(),i++}}function l(){for(var t=i,o=n[i++].split(/@@ -(\d+)(?:,(\d+))? \+(\d+)(?:,(\d+))? @@/),s={oldStart:+o[1],oldLines:+o[2]||1,newStart:+o[3],newLines:+o[4]||1,lines:[],linedelimiters:[]},a=0,l=0;i<n.length&&!(0===n[i].indexOf("--- ")&&i+2<n.length&&0===n[i+1].indexOf("+++ ")&&0===n[i+2].indexOf("@@"));i++){var u=0==n[i].length&&i!=n.length-1?" ":n[i][0];if("+"!==u&&"-"!==u&&" "!==u&&"\\"!==u)break;s.lines.push(n[i]),s.linedelimiters.push(r[i]||"\n"),"+"===u?a++:"-"===u?l++:" "===u&&(a++,l++)}if(a||1!==s.newLines||(s.newLines=0),l||1!==s.oldLines||(s.oldLines=0),e.strict){if(a!==s.newLines)throw new Error("Added line count did not match for hunk at line "+(t+1));if(l!==s.oldLines)throw new Error("Removed line count did not match for hunk at line "+(t+1))}return s}for(;i<n.length;)s();return o}function x(t,e,n){var r=!0,o=!1,i=!1,s=1;return function a(){if(r&&!i){if(o?s++:r=!1,t+s<=n)return s;i=!0}if(!o)return i||(r=!0),e<=t-s?-s++:(o=!0,a())}}function S(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("string"==typeof e&&(e=w(e)),Array.isArray(e)){if(e.length>1)throw new Error("applyPatch only works with a single input.");e=e[0]}var r,o,i=t.split(/\r\n|[\n\v\f\r\x85]/),s=t.match(/\r\n|[\n\v\f\r\x85]/g)||[],a=e.hunks,l=n.compareLine||function(t,e,n,r){return e===r},u=0,c=n.fuzzFactor||0,p=0,h=0;function f(t,e){for(var n=0;n<t.lines.length;n++){var r=t.lines[n],o=r.length>0?r[0]:" ",s=r.length>0?r.substr(1):r;if(" "===o||"-"===o){if(!l(e+1,i[e],o,s)&&++u>c)return!1;e++}}return!0}for(var d=0;d<a.length;d++){for(var m=a[d],v=i.length-m.oldLines,y=0,g=h+m.oldStart-1,S=x(g,p,v);void 0!==y;y=S())if(f(m,g+y)){m.offset=h+=y;break}if(void 0===y)return!1;p=m.offset+m.oldStart+m.oldLines}for(var k=0,O=0;O<a.length;O++){var b=a[O],N=b.oldStart+b.offset+k-1;k+=b.newLines-b.oldLines,N<0&&(N=0);for(var E=0;E<b.lines.length;E++){var C=b.lines[E],M=C.length>0?C[0]:" ",z=C.length>0?C.substr(1):C,T=b.linedelimiters[E];if(" "===M)N++;else if("-"===M)i.splice(N,1),s.splice(N,1);else if("+"===M)i.splice(N,0,z),s.splice(N,0,T),N++;else if("\\"===M){var j=b.lines[E-1]?b.lines[E-1][0]:null;"+"===j?r=!0:"-"===j&&(o=!0)}}}if(r)for(;!i[i.length-1];)i.pop(),s.pop();else o&&(i.push(""),s.push("\n"));for(var J=0;J<i.length-1;J++)i[J]=i[J]+s[J];return i.join("")}function k(t,e,n,r,o,i,s){s||(s={}),void 0===s.context&&(s.context=4);var a=c(n,r,s);function l(t){return t.map((function(t){return" "+t}))}a.push({value:"",lines:[]});for(var u=[],p=0,h=0,f=[],m=1,v=1,y=function(t){var e=a[t],o=e.lines||e.value.replace(/\n$/,"").split("\n");if(e.lines=o,e.added||e.removed){var i;if(!p){var c=a[t-1];p=m,h=v,c&&(f=s.context>0?l(c.lines.slice(-s.context)):[],p-=f.length,h-=f.length)}(i=f).push.apply(i,d(o.map((function(t){return(e.added?"+":"-")+t})))),e.added?v+=o.length:m+=o.length}else{if(p)if(o.length<=2*s.context&&t<a.length-2){var y;(y=f).push.apply(y,d(l(o)))}else{var g,w=Math.min(o.length,s.context);(g=f).push.apply(g,d(l(o.slice(0,w))));var x={oldStart:p,oldLines:m-p+w,newStart:h,newLines:v-h+w,lines:f};if(t>=a.length-2&&o.length<=s.context){var S=/\n$/.test(n),k=/\n$/.test(r),O=0==o.length&&f.length>x.oldLines;!S&&O&&f.splice(x.oldLines,0,"\\ No newline at end of file"),(S||O)&&k||f.push("\\ No newline at end of file")}u.push(x),p=0,h=0,f=[]}m+=o.length,v+=o.length}},g=0;g<a.length;g++)y(g);return{oldFileName:t,newFileName:e,oldHeader:o,newHeader:i,hunks:u}}function O(t,e,n,r,o,i,s){var a=k(t,e,n,r,o,i,s),l=[];t==e&&l.push("Index: "+t),l.push("==================================================================="),l.push("--- "+a.oldFileName+(void 0===a.oldHeader?"":"\t"+a.oldHeader)),l.push("+++ "+a.newFileName+(void 0===a.newHeader?"":"\t"+a.newHeader));for(var u=0;u<a.hunks.length;u++){var c=a.hunks[u];l.push("@@ -"+c.oldStart+","+c.oldLines+" +"+c.newStart+","+c.newLines+" @@"),l.push.apply(l,c.lines)}return l.join("\n")+"\n"}function b(t,e){if(e.length>t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function N(t){var e=function t(e){var n=0,r=0;return e.forEach((function(e){if("string"!=typeof e){var o=t(e.mine),i=t(e.theirs);void 0!==n&&(o.oldLines===i.oldLines?n+=o.oldLines:n=void 0),void 0!==r&&(o.newLines===i.newLines?r+=o.newLines:r=void 0)}else void 0===r||"+"!==e[0]&&" "!==e[0]||r++,void 0===n||"-"!==e[0]&&" "!==e[0]||n++})),{oldLines:n,newLines:r}}(t.lines),n=e.oldLines,r=e.newLines;void 0!==n?t.oldLines=n:delete t.oldLines,void 0!==r?t.newLines=r:delete t.newLines}function E(t,e){if("string"==typeof t){if(/^@@/m.test(t)||/^Index:/m.test(t))return w(t)[0];if(!e)throw new Error("Must provide a base reference or pass in a patch");return k(void 0,void 0,e,t)}return t}function C(t){return t.newFileName&&t.newFileName!==t.oldFileName}function M(t,e,n){return e===n?e:(t.conflict=!0,{mine:e,theirs:n})}function z(t,e){return t.oldStart<e.oldStart&&t.oldStart+t.oldLines<e.oldStart}function T(t,e){return{oldStart:t.oldStart,oldLines:t.oldLines,newStart:t.newStart+e,newLines:t.newLines,lines:t.lines}}function j(t,e,n,r,o){var i={offset:e,lines:n,index:0},s={offset:r,lines:o,index:0};for(R(t,i,s),R(t,s,i);i.index<i.lines.length&&s.index<s.lines.length;){var a=i.lines[i.index],l=s.lines[s.index];if("-"!==a[0]&&"+"!==a[0]||"-"!==l[0]&&"+"!==l[0])if("+"===a[0]&&" "===l[0]){var u;(u=t.lines).push.apply(u,d(P(i)))}else if("+"===l[0]&&" "===a[0]){var c;(c=t.lines).push.apply(c,d(P(s)))}else"-"===a[0]&&" "===l[0]?A(t,i,s):"-"===l[0]&&" "===a[0]?A(t,s,i,!0):a===l?(t.lines.push(a),i.index++,s.index++):F(t,P(i),P(s));else J(t,i,s)}I(t,i),I(t,s),N(t)}function J(t,e,n){var r,o,i=P(e),s=P(n);if(_(i)&&_(s)){var a,l;if(b(i,s)&&L(n,i,i.length-s.length))return void(a=t.lines).push.apply(a,d(i));if(b(s,i)&&L(e,s,s.length-i.length))return void(l=t.lines).push.apply(l,d(s))}else if(o=s,(r=i).length===o.length&&b(r,o)){var u;return void(u=t.lines).push.apply(u,d(i))}F(t,i,s)}function A(t,e,n,r){var o,i=P(e),s=function(t,e){for(var n=[],r=[],o=0,i=!1,s=!1;o<e.length&&t.index<t.lines.length;){var a=t.lines[t.index],l=e[o];if("+"===l[0])break;if(i=i||" "!==a[0],r.push(l),o++,"+"===a[0])for(s=!0;"+"===a[0];)n.push(a),a=t.lines[++t.index];l.substr(1)===a.substr(1)?(n.push(a),t.index++):s=!0}if("+"===(e[o]||"")[0]&&i&&(s=!0),s)return n;for(;o<e.length;)r.push(e[o++]);return{merged:r,changes:n}}(n,i);s.merged?(o=t.lines).push.apply(o,d(s.merged)):F(t,r?s:i,r?i:s)}function F(t,e,n){t.conflict=!0,t.lines.push({conflict:!0,mine:e,theirs:n})}function R(t,e,n){for(;e.offset<n.offset&&e.index<e.lines.length;){var r=e.lines[e.index++];t.lines.push(r),e.offset++}}function I(t,e){for(;e.index<e.lines.length;){var n=e.lines[e.index++];t.lines.push(n)}}function P(t){for(var e=[],n=t.lines[t.index][0];t.index<t.lines.length;){var r=t.lines[t.index];if("-"===n&&"+"===r[0]&&(n="+"),n!==r[0])break;e.push(r),t.index++}return e}function _(t){return t.reduce((function(t,e){return t&&"-"===e[0]}),!0)}function L(t,e,n){for(var r=0;r<n;r++){var o=e[e.length-n+r].substr(1);if(t.lines[t.index+r]!==" "+o)return!1}return t.index+=n,!0}g.tokenize=function(t){return t.slice()},g.join=g.removeEmpty=function(t){return t},t.Diff=e,t.diffChars=function(t,e,n){return o.diff(t,e,n)},t.diffWords=function(t,e,n){return n=i(n,{ignoreWhitespace:!0}),l.diff(t,e,n)},t.diffWordsWithSpace=function(t,e,n){return l.diff(t,e,n)},t.diffLines=c,t.diffTrimmedLines=function(t,e,n){var r=i(n,{ignoreWhitespace:!0});return u.diff(t,e,r)},t.diffSentences=function(t,e,n){return p.diff(t,e,n)},t.diffCss=function(t,e,n){return h.diff(t,e,n)},t.diffJson=function(t,e,n){return v.diff(t,e,n)},t.diffArrays=function(t,e,n){return g.diff(t,e,n)},t.structuredPatch=k,t.createTwoFilesPatch=O,t.createPatch=function(t,e,n,r,o,i){return O(t,t,e,n,r,o,i)},t.applyPatch=S,t.applyPatches=function(t,e){"string"==typeof t&&(t=w(t));var n=0;!function r(){var o=t[n++];if(!o)return e.complete();e.loadFile(o,(function(t,n){if(t)return e.complete(t);var i=S(n,o,e);e.patched(o,i,(function(t){if(t)return e.complete(t);r()}))}))}()},t.parsePatch=w,t.merge=function(t,e,n){t=E(t,n),e=E(e,n);var r={};(t.index||e.index)&&(r.index=t.index||e.index),(t.newFileName||e.newFileName)&&(C(t)?C(e)?(r.oldFileName=M(r,t.oldFileName,e.oldFileName),r.newFileName=M(r,t.newFileName,e.newFileName),r.oldHeader=M(r,t.oldHeader,e.oldHeader),r.newHeader=M(r,t.newHeader,e.newHeader)):(r.oldFileName=t.oldFileName,r.newFileName=t.newFileName,r.oldHeader=t.oldHeader,r.newHeader=t.newHeader):(r.oldFileName=e.oldFileName||t.oldFileName,r.newFileName=e.newFileName||t.newFileName,r.oldHeader=e.oldHeader||t.oldHeader,r.newHeader=e.newHeader||t.newHeader)),r.hunks=[];for(var o=0,i=0,s=0,a=0;o<t.hunks.length||i<e.hunks.length;){var l=t.hunks[o]||{oldStart:1/0},u=e.hunks[i]||{oldStart:1/0};if(z(l,u))r.hunks.push(T(l,s)),o++,a+=l.newLines-l.oldLines;else if(z(u,l))r.hunks.push(T(u,a)),i++,s+=u.newLines-u.oldLines;else{var c={oldStart:Math.min(l.oldStart,u.oldStart),oldLines:0,newStart:Math.min(l.newStart+s,u.oldStart+a),newLines:0,lines:[]};j(c,l.oldStart,l.lines,u.oldStart,u.lines),i++,o++,r.hunks.push(c)}}return r},t.convertChangesToDMP=function(t){for(var e,n,r=[],o=0;o<t.length;o++)n=(e=t[o]).added?1:e.removed?-1:0,r.push([n,e.value]);return r},t.convertChangesToXML=function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n];r.added?e.push("<ins>"):r.removed&&e.push("<del>"),e.push((o=r.value,void 0,o.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"))),r.added?e.push("</ins>"):r.removed&&e.push("</del>")}var o;return e.join("")},t.canonicalize=y,Object.defineProperty(t,"__esModule",{value:!0})}(e)},function(t,e,n){"use strict";function r(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function o(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){void 0===t&&(t=[""]),this.tokens=t}return t.fromJSON=function(e){var n=e.split("/").map(r);if(""!==n[0])throw new Error("Invalid JSON Pointer: "+e);return new t(n)},t.prototype.toString=function(){return this.tokens.map(o).join("/")},t.prototype.evaluate=function(t){for(var e=null,n="",r=t,o=1,i=this.tokens.length;o<i;o++)r=((e=r)||{})[n=this.tokens[o]];return{parent:e,key:n,value:r}},t.prototype.get=function(t){return this.evaluate(t).value},t.prototype.set=function(t,e){for(var n=t,r=1,o=this.tokens.length-1,i=this.tokens[r];r<o;r++)n=(n||{})[i];n&&(n[this.tokens[this.tokens.length-1]]=e)},t.prototype.push=function(t){this.tokens.push(t)},t.prototype.add=function(e){return new t(this.tokens.concat(String(e)))},t}();e.Pointer=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=Object.prototype.hasOwnProperty;function o(t){return void 0===t?"undefined":null===t?"null":Array.isArray(t)?"array":typeof t}function i(t,e){if(t===e)return!0;var n=o(t),s=o(e);return"array"==n&&"array"==s?function(t,e){var n=t.length;if(n!==e.length)return!1;for(var r=0;r<n;r++)if(!i(t[r],e[r]))return!1;return!0}(t,e):"object"==n&&"object"==s&&function(t,e){var n=Object.keys(t),o=Object.keys(e),s=n.length;if(s!==o.length)return!1;for(var a=0;a<s;a++){var l=n[a];if(!r.call(e,l)||!i(t[l],e[l]))return!1}return!0}(t,e)}e.objectType=o,e.compare=i},function(t,e,n){t.exports=n(8)},function(t,e,n){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),s=n(6),a=n(3),l=function(t){function e(e){var n=t.call(this,"Value required at path: "+e)||this;return n.path=e,n.name="MissingError",n}return o(e,t),e}(Error);e.MissingError=l;var u=function(t){function e(e,n){var r=t.call(this,"Test failed: "+e+" != "+n)||this;return r.actual=e,r.expected=n,r.name="TestError",r.actual=e,r.expected=n,r}return o(e,t),e}(Error);function c(t,e,n){if(Array.isArray(t))if("-"==e)t.push(n);else{var r=parseInt(e,10);t.splice(r,0,n)}else t[e]=n}function p(t,e){if(Array.isArray(t)){var n=parseInt(e,10);t.splice(n,1)}else delete t[e]}function h(t,e){var n=i.Pointer.fromJSON(e.path).evaluate(t);return void 0===n.parent?new l(e.path):(c(n.parent,n.key,s.clone(e.value)),null)}function f(t,e){var n=i.Pointer.fromJSON(e.path).evaluate(t);return void 0===n.value?new l(e.path):(p(n.parent,n.key),null)}function d(t,e){var n=i.Pointer.fromJSON(e.path).evaluate(t);if(null===n.parent)return new l(e.path);if(Array.isArray(n.parent)){if(parseInt(n.key,10)>=n.parent.length)return new l(e.path)}else if(void 0===n.value)return new l(e.path);return n.parent[n.key]=e.value,null}function m(t,e){var n=i.Pointer.fromJSON(e.from).evaluate(t);if(void 0===n.value)return new l(e.from);var r=i.Pointer.fromJSON(e.path).evaluate(t);return void 0===r.parent?new l(e.path):(p(n.parent,n.key),c(r.parent,r.key,n.value),null)}function v(t,e){var n=i.Pointer.fromJSON(e.from).evaluate(t);if(void 0===n.value)return new l(e.from);var r=i.Pointer.fromJSON(e.path).evaluate(t);return void 0===r.parent?new l(e.path):(c(r.parent,r.key,s.clone(n.value)),null)}function y(t,e){var n=i.Pointer.fromJSON(e.path).evaluate(t);return a.compare(n.value,e.value)?null:new u(n.value,e.value)}e.TestError=u,e.add=h,e.remove=f,e.replace=d,e.move=m,e.copy=v,e.test=y;var g=function(t){function e(e){var n=t.call(this,"Invalid operation: "+e.op)||this;return n.operation=e,n.name="InvalidOperationError",n}return o(e,t),e}(Error);e.InvalidOperationError=g,e.apply=function(t,e){switch(e.op){case"add":return h(t,e);case"remove":return f(t,e);case"replace":return d(t,e);case"move":return m(t,e);case"copy":return v(t,e);case"test":return y(t,e)}return new g(e)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=Object.prototype.hasOwnProperty;e.clone=function t(e){if(null==e||"object"!=typeof e)return e;if(e.constructor==Array){for(var n=e.length,o=new Array(n),i=0;i<n;i++)o[i]=t(e[i]);return o}var s={};for(var a in e)r.call(e,a)&&(s[a]=t(e[a]));return s}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),o=Object.prototype.hasOwnProperty;function i(t,e){var n={};for(var r in t)o.call(t,r)&&void 0!==t[r]&&(n[r]=1);for(var i in e)o.call(e,i)&&void 0!==e[i]&&delete n[i];return Object.keys(n)}function s(t){for(var e=t.length,n={},r=0;r<e;r++){var i=t[r];for(var s in i)o.call(i,s)&&void 0!==i[s]&&(n[s]=(n[s]||0)+1)}for(var s in n)n[s]<e&&delete n[s];return Object.keys(n)}function a(t,e){return{operations:t.operations.concat(e),cost:t.cost+1}}function l(t,e,n,o){void 0===o&&(o=p);var i={"0,0":{operations:[],cost:0}};var s=isNaN(t.length)||t.length<=0?0:t.length,l=isNaN(e.length)||e.length<=0?0:e.length;return function n(o,s){var l=o+","+s,u=i[l];if(void 0===u){if(o>0&&s>0&&r.compare(t[o-1],e[s-1]))u=n(o-1,s-1);else{var c=[];if(o>0){var p=n(o-1,s),h={op:"remove",index:o-1};c.push(a(p,h))}if(s>0){var f=n(o,s-1),d={op:"add",index:o-1,value:e[s-1]};c.push(a(f,d))}if(o>0&&s>0){var m=n(o-1,s-1),v={op:"replace",index:o-1,original:t[o-1],value:e[s-1]};c.push(a(m,v))}u=c.sort((function(t,e){return t.cost-e.cost}))[0]}i[l]=u}return u}(s,l).operations.reduce((function(t,e){var r=t[0],i=t[1];if(function(t){return"add"===t.op}(e)){var a=e.index+1+i,l=a<s+i?String(a):"-",u={op:e.op,path:n.add(l).toString(),value:e.value};return[r.concat(u),i+1]}if(function(t){return"remove"===t.op}(e)){u={op:e.op,path:n.add(String(e.index+i)).toString()};return[r.concat(u),i-1]}var c=n.add(String(e.index+i)),p=o(e.original,e.value,c);return[r.concat.apply(r,p),i]}),[[],0])[0]}function u(t,e,n,r){void 0===r&&(r=p);var o=[];return i(t,e).forEach((function(t){o.push({op:"remove",path:n.add(t).toString()})})),i(e,t).forEach((function(t){o.push({op:"add",path:n.add(t).toString(),value:e[t]})})),s([t,e]).forEach((function(i){o.push.apply(o,r(t[i],e[i],n.add(i)))})),o}function c(t,e,n){return r.compare(t,e)?[]:[{op:"replace",path:n.toString(),value:e}]}function p(t,e,n,o){void 0===o&&(o=p);var i=r.objectType(t),s=r.objectType(e);return"array"==i&&"array"==s?l(t,e,n,o):"object"==i&&"object"==s?u(t,e,n,o):c(t,e,n)}e.isDestructive=function(t){var e=t.op;return"remove"===e||"replace"===e||"copy"===e||"move"===e},e.subtract=i,e.intersection=s,e.diffArrays=l,e.diffObjects=u,e.diffValues=c,e.diffAny=p},function(t,e,n){"use strict";n.r(e),n.d(e,"RecreateTransform",(function(){return et})),n.d(e,"recreateTransform",(function(){return nt}));class r{constructor(t,e){if(this.content=t,this.size=e||0,null==e)for(let e=0;e<t.length;e++)this.size+=t[e].nodeSize}nodesBetween(t,e,n,r=0,o){for(let i=0,s=0;s<e;i++){let a=this.content[i],l=s+a.nodeSize;if(l>t&&!1!==n(a,r+s,o,i)&&a.content.size){let o=s+1;a.nodesBetween(Math.max(0,t-o),Math.min(a.content.size,e-o),n,r+o)}s=l}}descendants(t){this.nodesBetween(0,this.size,t)}textBetween(t,e,n,r){let o="",i=!0;return this.nodesBetween(t,e,(s,a)=>{s.isText?(o+=s.text.slice(Math.max(t,a)-a,e-a),i=!n):s.isLeaf&&r?(o+=r,i=!n):!i&&s.isBlock&&(o+=n,i=!0)},0),o}append(t){if(!t.size)return this;if(!this.size)return t;let e=this.lastChild,n=t.firstChild,o=this.content.slice(),i=0;for(e.isText&&e.sameMarkup(n)&&(o[o.length-1]=e.withText(e.text+n.text),i=1);i<t.content.length;i++)o.push(t.content[i]);return new r(o,this.size+t.size)}cut(t,e){if(null==e&&(e=this.size),0==t&&e==this.size)return this;let n=[],o=0;if(e>t)for(let r=0,i=0;i<e;r++){let s=this.content[r],a=i+s.nodeSize;a>t&&((i<t||a>e)&&(s=s.isText?s.cut(Math.max(0,t-i),Math.min(s.text.length,e-i)):s.cut(Math.max(0,t-i-1),Math.min(s.content.size,e-i-1))),n.push(s),o+=s.nodeSize),i=a}return new r(n,o)}cutByIndex(t,e){return t==e?r.empty:0==t&&e==this.content.length?this:new r(this.content.slice(t,e))}replaceChild(t,e){let n=this.content[t];if(n==e)return this;let o=this.content.slice(),i=this.size+e.nodeSize-n.nodeSize;return o[t]=e,new r(o,i)}addToStart(t){return new r([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new r(this.content.concat(t),this.size+t.nodeSize)}eq(t){if(this.content.length!=t.content.length)return!1;for(let e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(t){let e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e}maybeChild(t){return this.content[t]}forEach(t){for(let e=0,n=0;e<this.content.length;e++){let r=this.content[e];t(r,n,e),n+=r.nodeSize}}findDiffStart(t,e=0){return function t(e,n,r){for(let o=0;;o++){if(o==e.childCount||o==n.childCount)return e.childCount==n.childCount?null:r;let i=e.child(o),s=n.child(o);if(i!=s){if(!i.sameMarkup(s))return r;if(i.isText&&i.text!=s.text){for(let t=0;i.text[t]==s.text[t];t++)r++;return r}if(i.content.size||s.content.size){let e=t(i.content,s.content,r+1);if(null!=e)return e}r+=i.nodeSize}else r+=i.nodeSize}}(this,t,e)}findDiffEnd(t,e=this.size,n=t.size){return function t(e,n,r,o){for(let i=e.childCount,s=n.childCount;;){if(0==i||0==s)return i==s?null:{a:r,b:o};let a=e.child(--i),l=n.child(--s),u=a.nodeSize;if(a!=l){if(!a.sameMarkup(l))return{a:r,b:o};if(a.isText&&a.text!=l.text){let t=0,e=Math.min(a.text.length,l.text.length);for(;t<e&&a.text[a.text.length-t-1]==l.text[l.text.length-t-1];)t++,r--,o--;return{a:r,b:o}}if(a.content.size||l.content.size){let e=t(a.content,l.content,r-1,o-1);if(e)return e}r-=u,o-=u}else r-=u,o-=u}}(this,t,e,n)}findIndex(t,e=-1){if(0==t)return i(0,t);if(t==this.size)return i(this.content.length,t);if(t>this.size||t<0)throw new RangeError(`Position ${t} outside of fragment (${this})`);for(let n=0,r=0;;n++){let o=r+this.child(n).nodeSize;if(o>=t)return o==t||e>0?i(n+1,o):i(n,r);r=o}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(t=>t.toJSON()):null}static fromJSON(t,e){if(!e)return r.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new r(e.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return r.empty;let e,n=0;for(let r=0;r<t.length;r++){let o=t[r];n+=o.nodeSize,r&&o.isText&&t[r-1].sameMarkup(o)?(e||(e=t.slice(0,r)),e[e.length-1]=o.withText(e[e.length-1].text+o.text)):e&&e.push(o)}return new r(e||t,n)}static from(t){if(!t)return r.empty;if(t instanceof r)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new r([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}const o={index:0,offset:0};function i(t,e){return o.index=t,o.offset=e,o}function s(t,e){if(t===e)return!0;if(!t||"object"!=typeof t||!e||"object"!=typeof e)return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!s(t[n],e[n]))return!1}else{for(let n in t)if(!(n in e)||!s(t[n],e[n]))return!1;for(let n in e)if(!(n in t))return!1}return!0}r.empty=new r([],0);class a{constructor(t,e){this.type=t,this.attrs=e}addToSet(t){let e,n=!1;for(let r=0;r<t.length;r++){let o=t[r];if(this.eq(o))return t;if(this.type.excludes(o.type))e||(e=t.slice(0,r));else{if(o.type.excludes(this.type))return t;!n&&o.type.rank>this.type.rank&&(e||(e=t.slice(0,r)),e.push(this),n=!0),e&&e.push(o)}}return e||(e=t.slice()),n||e.push(this),e}removeFromSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t}isInSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1}eq(t){return this==t||this.type==t.type&&s(this.attrs,t.attrs)}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");let n=t.marks[e.type];if(!n)throw new RangeError(`There is no mark type ${e.type} in this schema`);return n.create(e.attrs)}static sameSet(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0}static setFrom(t){if(!t||0==t.length)return a.none;if(t instanceof a)return[t];let e=t.slice();return e.sort((t,e)=>t.type.rank-e.type.rank),e}}function l(t){let e=Error.call(this,t);return e.__proto__=l.prototype,e}a.none=[],l.prototype=Object.create(Error.prototype),l.prototype.constructor=l,l.prototype.name="ReplaceError";class u{constructor(t,e,n){this.content=t,this.openStart=e,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,e){let n=function t(e,n,r,o){let{index:i,offset:s}=e.findIndex(n),a=e.maybeChild(i);if(s==n||a.isText)return o&&!o.canReplace(i,i,r)?null:e.cut(0,n).append(r).append(e.cut(n));let l=t(a.content,n-s-1,r);return l&&e.replaceChild(i,a.copy(l))}(this.content,t+this.openStart,e,null);return n&&new u(n,this.openStart,this.openEnd)}removeBetween(t,e){return new u(function t(e,n,r){let{index:o,offset:i}=e.findIndex(n),s=e.maybeChild(o),{index:a,offset:l}=e.findIndex(r);if(i==n||s.isText){if(l!=r&&!e.child(a).isText)throw new RangeError("Removing non-flat range");return e.cut(0,n).append(e.cut(r))}if(o!=a)throw new RangeError("Removing non-flat range");return e.replaceChild(o,s.copy(t(s.content,n-i-1,r-i-1)))}(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)}eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t}static fromJSON(t,e){if(!e)return u.empty;let n=e.openStart||0,o=e.openEnd||0;if("number"!=typeof n||"number"!=typeof o)throw new RangeError("Invalid input for Slice.fromJSON");return new u(r.fromJSON(t,e.content),e.openStart||0,e.openEnd||0)}static maxOpen(t,e=!0){let n=0,r=0;for(let r=t.firstChild;r&&!r.isLeaf&&(e||!r.type.spec.isolating);r=r.firstChild)n++;for(let n=t.lastChild;n&&!n.isLeaf&&(e||!n.type.spec.isolating);n=n.lastChild)r++;return new u(t,n,r)}}u.empty=new u(r.empty,0,0);Object.create(null);function c(t){this.content=t}c.prototype={constructor:c,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return-1==e?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,o=r.find(t),i=r.content.slice();return-1==o?i.push(n||t,e):(i[o+1]=e,n&&(i[o]=n)),new c(i)},remove:function(t){var e=this.find(t);if(-1==e)return this;var n=this.content.slice();return n.splice(e,2),new c(n)},addToStart:function(t,e){return new c([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new c(n)},addBefore:function(t,e,n){var r=this.remove(e),o=r.content.slice(),i=r.find(t);return o.splice(-1==i?o.length:i,0,e,n),new c(o)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return(t=c.from(t)).size?new c(t.content.concat(this.subtract(t).content)):this},append:function(t){return(t=c.from(t)).size?new c(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=c.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},get size(){return this.content.length>>1}},c.from=function(t){if(t instanceof c)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new c(e)};class p{constructor(t){this.validEnd=t,this.next=[],this.wrapCache=[]}static parse(t,e){let n=new h(t,e);if(null==n.next)return p.empty;let r=f(n);n.next&&n.err("Unexpected trailing text");let o=function(t){let e=Object.create(null);return function n(r){let o=[];r.forEach(e=>{t[e].forEach(({term:e,to:n})=>{if(!e)return;let r=o.indexOf(e),i=r>-1&&o[r+1];w(t,n).forEach(t=>{i||o.push(e,i=[]),-1==i.indexOf(t)&&i.push(t)})})});let i=e[r.join(",")]=new p(r.indexOf(t.length-1)>-1);for(let t=0;t<o.length;t+=2){let r=o[t+1].sort(g);i.next.push(o[t],e[r.join(",")]||n(r))}return i}(w(t,0))}(function(t){let e=[[]];return o(function t(e,i){if("choice"==e.type)return e.exprs.reduce((e,n)=>e.concat(t(n,i)),[]);if("seq"==e.type)for(let r=0;;r++){let s=t(e.exprs[r],i);if(r==e.exprs.length-1)return s;o(s,i=n())}else{if("star"==e.type){let s=n();return r(i,s),o(t(e.expr,s),s),[r(s)]}if("plus"==e.type){let s=n();return o(t(e.expr,i),s),o(t(e.expr,s),s),[r(s)]}if("opt"==e.type)return[r(i)].concat(t(e.expr,i));if("range"==e.type){let s=i;for(let r=0;r<e.min;r++){let r=n();o(t(e.expr,s),r),s=r}if(-1==e.max)o(t(e.expr,s),s);else for(let i=e.min;i<e.max;i++){let i=n();r(s,i),o(t(e.expr,s),i),s=i}return[r(s)]}if("name"==e.type)return[r(i,null,e.value)]}}(t,0),n()),e;function n(){return e.push([])-1}function r(t,n,r){let o={term:r,to:n};return e[t].push(o),o}function o(t,e){t.forEach(t=>t.to=e)}}(r));return function(t,e){for(let n=0,r=[t];n<r.length;n++){let t=r[n],o=!t.validEnd,i=[];for(let e=0;e<t.next.length;e+=2){let n=t.next[e],s=t.next[e+1];i.push(n.name),!o||n.isText||n.hasRequiredAttrs()||(o=!1),-1==r.indexOf(s)&&r.push(s)}o&&e.err("Only non-generatable nodes ("+i.join(", ")+") in a required position")}}(o,n),o}matchType(t){for(let e=0;e<this.next.length;e+=2)if(this.next[e]==t)return this.next[e+1];return null}matchFragment(t,e=0,n=t.childCount){let r=this;for(let o=e;r&&o<n;o++)r=r.matchType(t.child(o).type);return r}get inlineContent(){let t=this.next[0];return!!t&&t.isInline}get defaultType(){for(let t=0;t<this.next.length;t+=2){let e=this.next[t];if(!e.isText&&!e.hasRequiredAttrs())return e}}compatible(t){for(let e=0;e<this.next.length;e+=2)for(let n=0;n<t.next.length;n+=2)if(this.next[e]==t.next[n])return!0;return!1}fillBefore(t,e=!1,n=0){let o=[this];return function i(s,a){let l=s.matchFragment(t,n);if(l&&(!e||l.validEnd))return r.from(a.map(t=>t.createAndFill()));for(let t=0;t<s.next.length;t+=2){let e=s.next[t],n=s.next[t+1];if(!e.isText&&!e.hasRequiredAttrs()&&-1==o.indexOf(n)){o.push(n);let t=i(n,a.concat(e));if(t)return t}}}(this,[])}findWrapping(t){for(let e=0;e<this.wrapCache.length;e+=2)if(this.wrapCache[e]==t)return this.wrapCache[e+1];let e=this.computeWrapping(t);return this.wrapCache.push(t,e),e}computeWrapping(t){let e=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let r=n.shift(),o=r.match;if(o.matchType(t)){let t=[];for(let e=r;e.type;e=e.via)t.push(e.type);return t.reverse()}for(let t=0;t<o.next.length;t+=2){let i=o.next[t];i.isLeaf||i.hasRequiredAttrs()||i.name in e||r.type&&!o.next[t+1].validEnd||(n.push({match:i.contentMatch,type:i,via:r}),e[i.name]=!0)}}}get edgeCount(){return this.next.length>>1}edge(t){let e=t<<1;if(e>=this.next.length)throw new RangeError(`There's no ${t}th edge in this content match`);return{type:this.next[e],next:this.next[e+1]}}toString(){let t=[];return function e(n){t.push(n);for(let r=1;r<n.next.length;r+=2)-1==t.indexOf(n.next[r])&&e(n.next[r])}(this),t.map((e,n)=>{let r=n+(e.validEnd?"*":" ")+" ";for(let n=0;n<e.next.length;n+=2)r+=(n?", ":"")+e.next[n].name+"->"+t.indexOf(e.next[n+1]);return r}).join("\n")}}p.empty=new p(!0);class h{constructor(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.unshift()}get next(){return this.tokens[this.pos]}eat(t){return this.next==t&&(this.pos++||!0)}err(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")}}function f(t){let e=[];do{e.push(d(t))}while(t.eat("|"));return 1==e.length?e[0]:{type:"choice",exprs:e}}function d(t){let e=[];do{e.push(m(t))}while(t.next&&")"!=t.next&&"|"!=t.next);return 1==e.length?e[0]:{type:"seq",exprs:e}}function m(t){let e=function(t){if(t.eat("(")){let e=f(t);return t.eat(")")||t.err("Missing closing paren"),e}if(!/\W/.test(t.next)){let e=function(t,e){let n=t.nodeTypes,r=n[e];if(r)return[r];let o=[];for(let t in n){let r=n[t];r.groups.indexOf(e)>-1&&o.push(r)}0==o.length&&t.err("No node type or group '"+e+"' found");return o}(t,t.next).map(e=>(null==t.inline?t.inline=e.isInline:t.inline!=e.isInline&&t.err("Mixing inline and block content"),{type:"name",value:e}));return t.pos++,1==e.length?e[0]:{type:"choice",exprs:e}}t.err("Unexpected token '"+t.next+"'")}(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else{if(!t.eat("{"))break;e=y(t,e)}return e}function v(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function y(t,e){let n=v(t),r=n;return t.eat(",")&&(r="}"!=t.next?v(t):-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function g(t,e){return e-t}function w(t,e){let n=[];return function e(r){let o=t[r];if(1==o.length&&!o[0].term)return e(o[0].to);n.push(r);for(let t=0;t<o.length;t++){let{term:r,to:i}=o[t];r||-1!=n.indexOf(i)||e(i)}}(e),n.sort(g)}function x(t){let e=Object.create(null);for(let n in t){let r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function S(t,e){let n=Object.create(null);for(let r in t){let o=e&&e[r];if(void 0===o){let e=t[r];if(!e.hasDefault)throw new RangeError("No value supplied for attribute "+r);o=e.default}n[r]=o}return n}function k(t){let e=Object.create(null);if(t)for(let n in t)e[n]=new O(t[n]);return e}class O{constructor(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default"),this.default=t.default}get isRequired(){return!this.hasDefault}}class b{constructor(t,e,n,r){this.name=t,this.schema=n,this.spec=r,this.attrs=k(r.attrs),this.rank=e,this.excluded=null;let o=x(this.attrs);this.instance=o&&new a(this,o)}create(t){return!t&&this.instance?this.instance:new a(this,S(this.attrs,t))}static compile(t,e){let n=Object.create(null),r=0;return t.forEach((t,o)=>n[t]=new b(t,r++,e,o)),n}removeFromSet(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t.slice(0,e).concat(t.slice(e+1));return t}isInSet(t){for(let e=0;e<t.length;e++)if(t[e].type==this)return t[e]}excludes(t){return this.excluded.indexOf(t)>-1}}var N=Math.pow(2,16);function E(t){return 65535&t}var C=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=null),this.pos=t,this.deleted=e,this.recover=n},M=function(t,e){void 0===e&&(e=!1),this.ranges=t,this.inverted=e};M.prototype.recover=function(t){var e=0,n=E(t);if(!this.inverted)for(var r=0;r<n;r++)e+=this.ranges[3*r+2]-this.ranges[3*r+1];return this.ranges[3*n]+e+function(t){return(t-(65535&t))/N}(t)},M.prototype.mapResult=function(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},M.prototype.map=function(t,e){return void 0===e&&(e=1),this._map(t,e,!0)},M.prototype._map=function(t,e,n){for(var r=0,o=this.inverted?2:1,i=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var a=this.ranges[s]-(this.inverted?r:0);if(a>t)break;var l=this.ranges[s+o],u=this.ranges[s+i],c=a+l;if(t<=c){var p=a+r+((l?t==a?-1:t==c?1:e:e)<0?0:u);if(n)return p;var h=s/3+(t-a)*N;return new C(p,e<0?t!=a:t!=c,h)}r+=u-l}return n?t+r:new C(t+r)},M.prototype.touches=function(t,e){for(var n=0,r=E(e),o=this.inverted?2:1,i=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var a=this.ranges[s]-(this.inverted?n:0);if(a>t)break;var l=this.ranges[s+o];if(t<=a+l&&s==3*r)return!0;n+=this.ranges[s+i]-l}return!1},M.prototype.forEach=function(t){for(var e=this.inverted?2:1,n=this.inverted?1:2,r=0,o=0;r<this.ranges.length;r+=3){var i=this.ranges[r],s=i-(this.inverted?o:0),a=i+(this.inverted?0:o),l=this.ranges[r+e],u=this.ranges[r+n];t(s,s+l,a,a+u),o+=u-l}},M.prototype.invert=function(){return new M(this.ranges,!this.inverted)},M.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)},M.offset=function(t){return 0==t?M.empty:new M(t<0?[0,-t,0]:[0,0,t])},M.empty=new M([]);var z=function(t,e,n,r){this.maps=t||[],this.from=n||0,this.to=null==r?this.maps.length:r,this.mirror=e};function T(t){var e=Error.call(this,t);return e.__proto__=T.prototype,e}z.prototype.slice=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.maps.length),new z(this.maps,this.mirror,t,e)},z.prototype.copy=function(){return new z(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)},z.prototype.appendMap=function(t,e){this.to=this.maps.push(t),null!=e&&this.setMirror(this.maps.length-1,e)},z.prototype.appendMapping=function(t){for(var e=0,n=this.maps.length;e<t.maps.length;e++){var r=t.getMirror(e);this.appendMap(t.maps[e],null!=r&&r<e?n+r:null)}},z.prototype.getMirror=function(t){if(this.mirror)for(var e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]},z.prototype.setMirror=function(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)},z.prototype.appendMappingInverted=function(t){for(var e=t.maps.length-1,n=this.maps.length+t.maps.length;e>=0;e--){var r=t.getMirror(e);this.appendMap(t.maps[e].invert(),null!=r&&r>e?n-r-1:null)}},z.prototype.invert=function(){var t=new z;return t.appendMappingInverted(this),t},z.prototype.map=function(t,e){if(void 0===e&&(e=1),this.mirror)return this._map(t,e,!0);for(var n=this.from;n<this.to;n++)t=this.maps[n].map(t,e);return t},z.prototype.mapResult=function(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},z.prototype._map=function(t,e,n){for(var r=!1,o=null,i=this.from;i<this.to;i++){var s=this.maps[i],a=o&&o[i];if(null!=a&&s.touches(t,a))t=s.recover(a);else{var l=s.mapResult(t,e);if(null!=l.recover){var u=this.getMirror(i);if(null!=u&&u>i&&u<this.to){if(l.deleted){i=u,t=this.maps[u].recover(l.recover);continue}(o||(o=Object.create(null)))[u]=l.recover}}l.deleted&&(r=!0),t=l.pos}}return n?t:new C(t,r)},T.prototype=Object.create(Error.prototype),T.prototype.constructor=T,T.prototype.name="TransformError";var j=function(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new z},J={before:{configurable:!0},docChanged:{configurable:!0}};function A(){throw new Error("Override me")}J.before.get=function(){return this.docs.length?this.docs[0]:this.doc},j.prototype.step=function(t){var e=this.maybeStep(t);if(e.failed)throw new T(e.failed);return this},j.prototype.maybeStep=function(t){var e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e},J.docChanged.get=function(){return this.steps.length>0},j.prototype.addStep=function(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e},Object.defineProperties(j.prototype,J);var F=Object.create(null),R=function(){};R.prototype.apply=function(t){return A()},R.prototype.getMap=function(){return M.empty},R.prototype.invert=function(t){return A()},R.prototype.map=function(t){return A()},R.prototype.merge=function(t){return null},R.prototype.toJSON=function(){return A()},R.fromJSON=function(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");var n=F[e.stepType];if(!n)throw new RangeError("No step type "+e.stepType+" defined");return n.fromJSON(t,e)},R.jsonID=function(t,e){if(t in F)throw new RangeError("Duplicate use of step JSON ID "+t);return F[t]=e,e.prototype.jsonID=t,e};var I=function(t,e){this.doc=t,this.failed=e};I.ok=function(t){return new I(t,null)},I.fail=function(t){return new I(null,t)},I.fromReplace=function(t,e,n,r){try{return I.ok(t.replace(e,n,r))}catch(t){if(t instanceof l)return I.fail(t.message);throw t}};var P=function(t){function e(e,n,r,o){t.call(this),this.from=e,this.to=n,this.slice=r,this.structure=!!o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){return this.structure&&L(t,this.from,this.to)?I.fail("Structure replace would overwrite content"):I.fromReplace(t,this.from,this.to,this.slice)},e.prototype.getMap=function(){return new M([this.from,this.to-this.from,this.slice.size])},e.prototype.invert=function(t){return new e(this.from,this.from+this.slice.size,t.slice(this.from,this.to))},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted?null:new e(n.pos,Math.max(n.pos,r.pos),this.slice)},e.prototype.merge=function(t){if(!(t instanceof e)||t.structure!=this.structure)return null;if(this.from+this.slice.size!=t.from||this.slice.openEnd||t.slice.openStart){if(t.to!=this.from||this.slice.openStart||t.slice.openEnd)return null;var n=this.slice.size+t.slice.size==0?u.empty:new u(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new e(t.from,this.to,n,this.structure)}var r=this.slice.size+t.slice.size==0?u.empty:new u(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new e(this.from,this.to+(t.to-t.from),r,this.structure)},e.prototype.toJSON=function(){var t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new e(n.from,n.to,u.fromJSON(t,n.slice),!!n.structure)},e}(R);R.jsonID("replace",P);var _=function(t){function e(e,n,r,o,i,s,a){t.call(this),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=o,this.slice=i,this.insert=s,this.structure=!!a}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){if(this.structure&&(L(t,this.from,this.gapFrom)||L(t,this.gapTo,this.to)))return I.fail("Structure gap-replace would overwrite content");var e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return I.fail("Gap is not a flat range");var n=this.slice.insertAt(this.insert,e.content);return n?I.fromReplace(t,this.from,this.to,n):I.fail("Content does not fit in gap")},e.prototype.getMap=function(){return new M([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},e.prototype.invert=function(t){var n=this.gapTo-this.gapFrom;return new e(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1),o=t.map(this.gapFrom,-1),i=t.map(this.gapTo,1);return n.deleted&&r.deleted||o<n.pos||i>r.pos?null:new e(n.pos,r.pos,o,i,this.slice,this.insert,this.structure)},e.prototype.toJSON=function(){var t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to||"number"!=typeof n.gapFrom||"number"!=typeof n.gapTo||"number"!=typeof n.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new e(n.from,n.to,n.gapFrom,n.gapTo,u.fromJSON(t,n.slice),n.insert,!!n.structure)},e}(R);function L(t,e,n){for(var r=t.resolve(e),o=n-e,i=r.depth;o>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,o--;if(o>0)for(var s=r.node(i).maybeChild(r.indexAfter(i));o>0;){if(!s||s.isLeaf)return!0;s=s.firstChild,o--}return!1}function D(t,e,n){for(var o=[],i=0;i<t.childCount;i++){var s=t.child(i);s.content.size&&(s=s.copy(D(s.content,e,s))),s.isInline&&(s=e(s,n,i)),o.push(s)}return r.fromArray(o)}R.jsonID("replaceAround",_),j.prototype.lift=function(t,e){for(var n=t.$from,o=t.$to,i=t.depth,s=n.before(i+1),a=o.after(i+1),l=s,c=a,p=r.empty,h=0,f=i,d=!1;f>e;f--)d||n.index(f)>0?(d=!0,p=r.from(n.node(f).copy(p)),h++):l--;for(var m=r.empty,v=0,y=i,g=!1;y>e;y--)g||o.after(y+1)<o.end(y)?(g=!0,m=r.from(o.node(y).copy(m)),v++):c++;return this.step(new _(l,c,s,a,new u(p.append(m),h,v),p.size-h,!0))},j.prototype.wrap=function(t,e){for(var n=r.empty,o=e.length-1;o>=0;o--)n=r.from(e[o].type.create(e[o].attrs,n));var i=t.start,s=t.end;return this.step(new _(i,s,i,s,new u(n,0,0),e.length,!0))},j.prototype.setBlockType=function(t,e,n,o){var i=this;if(void 0===e&&(e=t),!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var s=this.steps.length;return this.doc.nodesBetween(t,e,(function(t,e){if(t.isTextblock&&!t.hasMarkup(n,o)&&function(t,e,n){var r=t.resolve(e),o=r.index();return r.parent.canReplaceWith(o,o+1,n)}(i.doc,i.mapping.slice(s).map(e),n)){i.clearIncompatible(i.mapping.slice(s).map(e,1),n);var a=i.mapping.slice(s),l=a.map(e,1),c=a.map(e+t.nodeSize,1);return i.step(new _(l,c,l+1,c-1,new u(r.from(n.create(o,null,t.marks)),0,0),1,!0)),!1}})),this},j.prototype.setNodeMarkup=function(t,e,n,o){var i=this.doc.nodeAt(t);if(!i)throw new RangeError("No node at given position");e||(e=i.type);var s=e.create(n,null,o||i.marks);if(i.isLeaf)return this.replaceWith(t,t+i.nodeSize,s);if(!e.validContent(i.content))throw new RangeError("Invalid content for node type "+e.name);return this.step(new _(t,t+i.nodeSize,t+1,t+i.nodeSize-1,new u(r.from(s),0,0),1,!0))},j.prototype.split=function(t,e,n){void 0===e&&(e=1);for(var o=this.doc.resolve(t),i=r.empty,s=r.empty,a=o.depth,l=o.depth-e,c=e-1;a>l;a--,c--){i=r.from(o.node(a).copy(i));var p=n&&n[c];s=r.from(p?p.type.create(p.attrs,s):o.node(a).copy(s))}return this.step(new P(t,t,new u(i.append(s),e,e),!0))},j.prototype.join=function(t,e){void 0===e&&(e=1);var n=new P(t-e,t+e,u.empty,!0);return this.step(n)};var B=function(t){function e(e,n,r){t.call(this),this.from=e,this.to=n,this.mark=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){var e=this,n=t.slice(this.from,this.to),r=t.resolve(this.from),o=r.node(r.sharedDepth(this.to)),i=new u(D(n.content,(function(t,n){return n.type.allowsMarkType(e.mark.type)?t.mark(e.mark.addToSet(t.marks)):t}),o),n.openStart,n.openEnd);return I.fromReplace(t,this.from,this.to,i)},e.prototype.invert=function(){return new q(this.from,this.to,this.mark)},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new e(n.pos,r.pos,this.mark)},e.prototype.merge=function(t){if(t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from)return new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new e(n.from,n.to,t.markFromJSON(n.mark))},e}(R);R.jsonID("addMark",B);var q=function(t){function e(e,n,r){t.call(this),this.from=e,this.to=n,this.mark=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){var e=this,n=t.slice(this.from,this.to),r=new u(D(n.content,(function(t){return t.mark(e.mark.removeFromSet(t.marks))})),n.openStart,n.openEnd);return I.fromReplace(t,this.from,this.to,r)},e.prototype.invert=function(){return new B(this.from,this.to,this.mark)},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new e(n.pos,r.pos,this.mark)},e.prototype.merge=function(t){if(t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from)return new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new e(n.from,n.to,t.markFromJSON(n.mark))},e}(R);function W(t,e,n,o){if(void 0===n&&(n=e),void 0===o&&(o=u.empty),e==n&&!o.size)return null;var i=t.resolve(e),s=t.resolve(n);if(U(i,s,o))return new P(e,n,o);var a=function(t,e){var n=function t(e,n,o,i){var s=r.empty,a=0,l=o[n];if(e.depth>n){var u=t(e,n+1,o,i||l);a=u.openEnd+1,s=r.from(e.node(n+1).copy(u.content))}l&&(s=s.append(l.content),a=l.openEnd);i&&(s=s.append(e.node(n).contentMatchAt(e.indexAfter(n)).fillBefore(r.empty,!0)),a=0);return{content:s,openEnd:a}}(t,0,e,!1),o=n.content,i=n.openEnd;return new u(o,t.depth,i||0)}(i,function(t,e){for(var n=new V(t),r=1;e.size&&r<=3;r++){var o=n.placeSlice(e.content,e.openStart,e.openEnd,r);3==r&&o!=e&&o.size&&(r=0),e=o}for(;n.open.length;)n.closeNode();return n.placed}(i,o)),l=$(i,s,a);if(!l)return null;if(a.size!=l.size&&function(t,e,n){if(!e.parent.isTextblock)return!1;var r,o=n.openEnd?function(t,e){for(var n=1;n<e;n++)t=t.lastChild.content;return t.lastChild}(n.content,n.openEnd):t.node(t.depth-(n.openStart-n.openEnd));if(!o.isTextblock)return!1;for(var i=e.index();i<e.parent.childCount;i++)if(!o.type.allowsMarks(e.parent.child(i).marks))return!1;n.openEnd?r=o.contentMatchAt(o.childCount):(r=o.contentMatchAt(o.childCount),n.size&&(r=r.matchFragment(n.content,n.openStart?1:0)));return(r=r.matchFragment(e.parent.content,e.index()))&&r.validEnd}(i,s,a)){for(var c=s.depth,p=s.after(c);c>1&&p==s.end(--c);)++p;var h=$(i,t.resolve(p),a);if(h)return new _(e,p,n,s.end(),h,a.size)}return l.size||e!=n?new P(e,n,l):null}function H(t,e,n,o,i,s,a){var l,u=t.childCount,c=u-(a>0?1:0),p=s<0?e:n.node(i);l=s<0?p.contentMatchAt(c):1==u&&a>0?p.contentMatchAt(s?n.index(i):n.indexAfter(i)):p.contentMatchAt(n.indexAfter(i)).matchFragment(t,u>0&&s?1:0,c);var h=o.node(i);if(a>0&&i<o.depth){var f=h.content.cutByIndex(o.indexAfter(i)).addToStart(t.lastChild),d=l.fillBefore(f,!0);if(d&&d.size&&s>0&&1==u&&(d=null),d){var m=H(t.lastChild.content,t.lastChild,n,o,i+1,1==u?s-1:-1,a-1);if(m){var v=t.lastChild.copy(m);return d.size?t.cutByIndex(0,u-1).append(d).addToEnd(v):t.replaceChild(u-1,v)}}}a>0&&(l=l.matchType((1==u&&s>0?n.node(i+1):t.lastChild).type));var y=o.index(i);if(y==h.childCount&&!h.type.compatibleContent(e.type))return null;for(var g=l.fillBefore(h.content,!0,y),w=y;g&&w<h.content.childCount;w++)p.type.allowsMarks(h.content.child(w).marks)||(g=null);if(!g)return null;if(a>0){var x=function t(e,n,o,i,s){var a,l=e.content,u=l.childCount;a=s>=0?o.node(i).contentMatchAt(o.indexAfter(i)).matchFragment(l,s>0?1:0,u):e.contentMatchAt(u);if(n>0){var c=t(l.lastChild,n-1,o,i+1,1==u?s-1:-1);l=l.replaceChild(u-1,c)}return e.copy(l.append(a.fillBefore(r.empty,!0)))}(t.lastChild,a-1,n,i+1,1==u?s-1:-1);t=t.replaceChild(u-1,x)}return t=t.append(g),o.depth>i&&(t=t.addToEnd(function t(e,n){var r=e.node(n),o=r.contentMatchAt(0).fillBefore(r.content,!0,e.index(n));e.depth>n&&(o=o.addToEnd(t(e,n+1)));return r.copy(o)}(o,i+1))),t}function $(t,e,n){var r=H(n.content,t.node(0),t,e,0,n.openStart,n.openEnd);return r?function(t,e,n){for(;e>0&&n>0&&1==t.childCount;)t=t.firstChild.content,e--,n--;return new u(t,e,n)}(r,n.openStart,e.depth):null}function U(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}R.jsonID("removeMark",q),j.prototype.addMark=function(t,e,n){var r=this,o=[],i=[],s=null,a=null;return this.doc.nodesBetween(t,e,(function(r,l,u){if(r.isInline){var c=r.marks;if(!n.isInSet(c)&&u.type.allowsMarkType(n.type)){for(var p=Math.max(l,t),h=Math.min(l+r.nodeSize,e),f=n.addToSet(c),d=0;d<c.length;d++)c[d].isInSet(f)||(s&&s.to==p&&s.mark.eq(c[d])?s.to=h:o.push(s=new q(p,h,c[d])));a&&a.to==p?a.to=h:i.push(a=new B(p,h,n))}}})),o.forEach((function(t){return r.step(t)})),i.forEach((function(t){return r.step(t)})),this},j.prototype.removeMark=function(t,e,n){var r=this;void 0===n&&(n=null);var o=[],i=0;return this.doc.nodesBetween(t,e,(function(r,s){if(r.isInline){i++;var a=null;if(n instanceof b){var l=n.isInSet(r.marks);l&&(a=[l])}else n?n.isInSet(r.marks)&&(a=[n]):a=r.marks;if(a&&a.length)for(var u=Math.min(s+r.nodeSize,e),c=0;c<a.length;c++){for(var p=a[c],h=void 0,f=0;f<o.length;f++){var d=o[f];d.step==i-1&&p.eq(o[f].style)&&(h=d)}h?(h.to=u,h.step=i):o.push({style:p,from:Math.max(s,t),to:u,step:i})}}})),o.forEach((function(t){return r.step(new q(t.from,t.to,t.style))})),this},j.prototype.clearIncompatible=function(t,e,n){void 0===n&&(n=e.contentMatch);for(var o=this.doc.nodeAt(t),i=[],s=t+1,a=0;a<o.childCount;a++){var l=o.child(a),c=s+l.nodeSize,p=n.matchType(l.type,l.attrs);if(p){n=p;for(var h=0;h<l.marks.length;h++)e.allowsMarkType(l.marks[h].type)||this.step(new q(s,c,l.marks[h]))}else i.push(new P(s,c,u.empty));s=c}if(!n.validEnd){var f=n.fillBefore(r.empty,!0);this.replace(s,s,new u(f,0,0))}for(var d=i.length-1;d>=0;d--)this.step(i[d]);return this},j.prototype.replace=function(t,e,n){void 0===e&&(e=t),void 0===n&&(n=u.empty);var r=W(this.doc,t,e,n);return r&&this.step(r),this},j.prototype.replaceWith=function(t,e,n){return this.replace(t,e,new u(r.from(n),0,0))},j.prototype.delete=function(t,e){return this.replace(t,e,u.empty)},j.prototype.insert=function(t,e){return this.replaceWith(t,t,e)};var V=function(t){this.open=[];for(var e=0;e<=t.depth;e++){var n=t.node(e),o=n.contentMatchAt(t.indexAfter(e));this.open.push({parent:n,match:o,content:r.empty,wrapper:!1,openEnd:0,depth:e})}this.placed=[]};function G(t,e,n){var r=t.content;if(e>1){var o=G(t.firstChild,e-1,1==t.childCount?n-1:0);r=t.content.replaceChild(0,o)}var i=t.type.contentMatch.fillBefore(r,0==n);return t.copy(i.append(r))}function X(t,e,n,o,i){if(e<n){var s=t.firstChild;t=t.replaceChild(0,s.copy(X(s.content,e+1,n,o,s)))}if(e>o){var a=i.contentMatchAt(0),l=a.fillBefore(t).append(t);t=l.append(a.matchFragment(l).fillBefore(r.empty,!0))}return t}function Z(t,e){for(var n=[],r=Math.min(t.depth,e.depth);r>=0;r--){var o=t.start(r);if(o<t.pos-(t.depth-r)||e.end(r)>e.pos+(e.depth-r)||t.node(r).type.spec.isolating||e.node(r).type.spec.isolating)break;o==e.start(r)&&n.push(r)}return n}V.prototype.placeSlice=function(t,e,n,o,i){if(e>0){var s=t.firstChild,a=this.placeSlice(s.content,Math.max(0,e-1),n&&1==t.childCount?n-1:0,o,s);a.content!=s.content&&(a.content.size?(t=t.replaceChild(0,s.copy(a.content)),e=a.openStart+1):(1==t.childCount&&(n=0),t=t.cutByIndex(1),e=0))}var l=this.placeContent(t,e,n,o,i);if(o>2&&l.size&&0==e){var c=l.content.firstChild,p=1==l.content.childCount;this.placeContent(c.content,0,n&&p?n-1:0,o,c),l=p?r.empty:new u(l.content.cutByIndex(1),0,n)}return l},V.prototype.placeContent=function(t,e,n,o,i){for(var s=0;s<t.childCount;s++){for(var a=t.child(s),l=!1,c=s==t.childCount-1,p=this.open.length-1;p>=0;p--){var h=this.open[p],f=void 0;if(o>1&&(f=h.match.findWrapping(a.type))&&(!i||!f.length||f[f.length-1]!=i.type)){for(;this.open.length-1>p;)this.closeNode();for(var d=0;d<f.length;d++)h.match=h.match.matchType(f[d]),p++,h={parent:f[d].create(),match:f[d].contentMatch,content:r.empty,wrapper:!0,openEnd:0,depth:p+d},this.open.push(h)}var m=h.match.matchType(a.type);if(!m){var v=h.match.fillBefore(r.from(a));if(!v){if(i&&h.match.matchType(i.type))break;continue}for(var y=0;y<v.childCount;y++){var g=v.child(y);this.addNode(h,g,0),m=h.match.matchFragment(g)}}for(;this.open.length-1>p;)this.closeNode();a=a.mark(h.parent.type.allowedMarks(a.marks)),e&&(a=G(a,e,c?n:0),e=0),this.addNode(h,a,c?n:0),h.match=m,c&&(n=0),l=!0;break}if(!l)break}return this.open.length>1&&(s>0&&s==t.childCount||i&&this.open[this.open.length-1].parent.type==i.type)&&this.closeNode(),new u(t.cutByIndex(s),e,n)},V.prototype.addNode=function(t,e,n){var o,i;t.content=(o=t.content,i=t.openEnd,i?o.replaceChild(o.childCount-1,function t(e,n){var o=e.content;if(n>1){var i=t(e.lastChild,n-1);o=e.content.replaceChild(e.childCount-1,i)}var s=e.contentMatchAt(e.childCount).fillBefore(r.empty,!0);return e.copy(o.append(s))}(o.lastChild,i)):o).addToEnd(e),t.openEnd=n},V.prototype.closeNode=function(){var t=this.open.pop();0==t.content.size||(t.wrapper?this.addNode(this.open[this.open.length-1],t.parent.copy(t.content),t.openEnd+1):this.placed[t.depth]={depth:t.depth,content:t.content,openEnd:t.openEnd})},j.prototype.replaceRange=function(t,e,n){if(!n.size)return this.deleteRange(t,e);var r=this.doc.resolve(t),o=this.doc.resolve(e);if(U(r,o,n))return this.step(new P(t,e,n));var i=Z(r,this.doc.resolve(e));0==i[i.length-1]&&i.pop();var s=-(r.depth+1);i.unshift(s);for(var a=r.depth,l=r.pos-1;a>0;a--,l--){var c=r.node(a).type.spec;if(c.defining||c.isolating)break;i.indexOf(a)>-1?s=a:r.before(a)==l&&i.splice(1,0,-a)}for(var p=i.indexOf(s),h=[],f=n.openStart,d=n.content,m=0;;m++){var v=d.firstChild;if(h.push(v),m==n.openStart)break;d=v.content}f>0&&h[f-1].type.spec.defining&&r.node(p).type!=h[f-1].type?f-=1:f>=2&&h[f-1].isTextblock&&h[f-2].type.spec.defining&&r.node(p).type!=h[f-2].type&&(f-=2);for(var y=n.openStart;y>=0;y--){var g=(y+f+1)%(n.openStart+1),w=h[g];if(w)for(var x=0;x<i.length;x++){var S=i[(x+p)%i.length],k=!0;S<0&&(k=!1,S=-S);var O=r.node(S-1),b=r.index(S-1);if(O.canReplaceWith(b,b,w.type,w.marks))return this.replace(r.before(S),k?o.after(S):e,new u(X(n.content,0,n.openStart,g),g,n.openEnd))}}for(var N=this.steps.length,E=i.length-1;E>=0&&(this.replace(t,e,n),!(this.steps.length>N));E--){var C=i[E];E<0||(t=r.before(C),e=o.after(C))}return this},j.prototype.replaceRangeWith=function(t,e,n){if(!n.isInline&&t==e&&this.doc.resolve(t).parent.content.size){var o=function(t,e,n){var r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(0==r.parentOffset)for(var o=r.depth-1;o>=0;o--){var i=r.index(o);if(r.node(o).canReplaceWith(i,i,n))return r.before(o+1);if(i>0)return null}if(r.parentOffset==r.parent.content.size)for(var s=r.depth-1;s>=0;s--){var a=r.indexAfter(s);if(r.node(s).canReplaceWith(a,a,n))return r.after(s+1);if(a<r.node(s).childCount)return null}}(this.doc,t,n.type);null!=o&&(t=e=o)}return this.replaceRange(t,e,new u(r.from(n),0,0))},j.prototype.deleteRange=function(t,e){for(var n=this.doc.resolve(t),r=this.doc.resolve(e),o=Z(n,r),i=0;i<o.length;i++){var s=o[i],a=i==o.length-1;if(a&&0==s||n.node(s).type.contentMatch.validEnd)return this.delete(n.start(s),r.end(s));if(s>0&&(a||n.node(s-1).canReplace(n.index(s-1),r.indexAfter(s-1))))return this.delete(n.before(s),r.after(s))}for(var l=1;l<=n.depth&&l<=r.depth;l++)if(t-n.start(l)==n.depth-l&&e>n.end(l)&&r.end(l)-e!=r.depth-l)return this.delete(n.before(l),e);return this.delete(t,e)};var K=n(0),Q=n(1);const Y=t=>JSON.parse(JSON.stringify(t));function tt(t,e){let n=e.content.findDiffStart(t.content);if(null===n)return!1;let{a:r,b:o}=e.content.findDiffEnd(t.content);const i=n-Math.min(r,o);return i>0&&(t.resolve(n-i).depth<e.resolve(r+i).depth?n-=i:(r+=i,o+=i)),new P(n,o,e.slice(n,r))}class et{constructor(t,e,n={}){const r=Object.assign({complexSteps:!0,wordDiffs:!1},n);this.fromDoc=t,this.toDoc=e,this.complexSteps=r.complexSteps,this.wordDiffs=r.wordDiffs,this.schema=t.type.schema,this.tr=new j(t)}init(){return this.complexSteps?(this.currentJSON=this.marklessDoc(this.fromDoc).toJSON(),this.finalJSON=this.marklessDoc(this.toDoc).toJSON(),this.ops=Object(K.createPatch)(this.currentJSON,this.finalJSON),this.recreateChangeContentSteps(),this.recreateChangeMarkSteps()):(this.currentJSON=this.fromDoc.toJSON(),this.finalJSON=this.toDoc.toJSON(),this.ops=Object(K.createPatch)(this.currentJSON,this.finalJSON),this.recreateChangeContentSteps()),this.simplifyTr(),this.tr}recreateChangeContentSteps(){let t=[];for(;this.ops.length;){let e,n=this.ops.shift();const r=Y(this.currentJSON),o=n.path.split("/");for(t.push(n);null==e;){Object(K.applyPatch)(r,[n]);try{e=this.schema.nodeFromJSON(r),e.check()}catch(r){if(e=null,!(this.ops.length>0))throw new Error(`No valid diff possible applying ${n.path}`);n=this.ops.shift(),t.push(n)}}this.complexSteps&&1===t.length&&(o.includes("attrs")||o.includes("type"))?(this.addSetNodeMarkup(),t=[]):1===t.length&&"replace"===n.op&&"text"===o[o.length-1]?(this.addReplaceTextSteps(n,r),t=[]):this.addReplaceStep(e,r)&&(t=[])}}recreateChangeMarkSteps(){this.toDoc.descendants((t,e)=>{if(!t.isInline)return!0;this.tr.doc.nodesBetween(e,e+t.nodeSize,(n,r)=>{if(!n.isInline)return!0;const o=Math.max(e,r),i=Math.min(e+t.nodeSize,r+n.nodeSize);n.marks.forEach(e=>{e.isInSet(t.marks)||this.tr.removeMark(o,i,e)}),t.marks.forEach(t=>{t.isInSet(n.marks)||this.tr.addMark(o,i,t)})})})}marklessDoc(t){const e=new j(t);return e.removeMark(0,t.nodeSize-2),e.doc}addReplaceStep(t,e){const n=tt(this.schema.nodeFromJSON(this.currentJSON),t);if(!n)return!1;if(!this.tr.maybeStep(n).failed)return this.currentJSON=e,!0;throw new Error("No valid step found.")}addSetNodeMarkup(){const t=this.schema.nodeFromJSON(this.currentJSON),e=this.schema.nodeFromJSON(this.finalJSON),n=e.content.findDiffStart(t.content),r=t.nodeAt(n),o=e.nodeAt(n);null!=n&&(this.tr.setNodeMarkup(n,r.type===o.type?null:o.type,o.attrs,o.marks),this.currentJSON=this.marklessDoc(this.tr.doc).toJSON(),this.ops=Object(K.createPatch)(this.currentJSON,this.finalJSON))}addReplaceTextSteps(t,e){const n=Object.assign(Object.assign({},t),{value:"xx"}),r=Object.assign(Object.assign({},t),{value:"yy"}),o=Y(this.currentJSON),i=Y(this.currentJSON),s=t.path.split("/");let a=this.currentJSON;Object(K.applyPatch)(o,[n]),Object(K.applyPatch)(i,[r]);const l=this.schema.nodeFromJSON(o),u=this.schema.nodeFromJSON(i);let c=l.content.findDiffStart(u.content);const p=l.resolve(c+1).marks();for(s.shift();s.length;){a=a[s.shift()]}const h=t.value,f=a,d=this.wordDiffs?Object(Q.diffWordsWithSpace)(f,h):Object(Q.diffChars)(f,h);for(;d.length;){const t=d.shift();if(t.added){if(d.length&&d[0].removed){const e=d.shift();this.tr.replaceWith(c,c+e.value.length,this.schema.nodeFromJSON({type:"text",text:t.value}).mark(p))}else this.tr.insert(c,this.schema.nodeFromJSON({type:"text",text:t.value}).mark(p));c+=t.value.length}else if(t.removed)if(d.length&&d[0].added){const e=d.shift();this.tr.replaceWith(c,c+t.value.length,this.schema.nodeFromJSON({type:"text",text:e.value}).mark(p)),c+=e.value.length}else this.tr.delete(c,c+t.value.length);else c+=t.value.length}this.currentJSON=e}simplifyTr(){if(!this.tr.steps.length)return;const t=new j(this.tr.docs[0]),e=this.tr.steps.slice();for(;e.length;){let n=e.shift();for(;e.length&&n.merge(e[0]);){const r=e.shift();n=n instanceof P&&r instanceof P?tt(t.doc,r.apply(n.apply(t.doc).doc).doc):n.merge(r)}t.step(n)}this.tr=t}}function nt(t,e,n={}){return new et(t,e,n).init()}}])}));
//# sourceMappingURL=main.js.map